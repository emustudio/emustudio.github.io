<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Assembler "as-8080" - User documentation for emuStudio</title> <link rel="shortcut icon" href="/documentation/user/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/documentation/user/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3492956-5"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-3492956-5', { 'anonymize_ip': true }); </script> <script src="/documentation/user/assets/js/vendor/lunr.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script src="/documentation/user/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Assembler “as-8080” | User documentation for emuStudio</title> <meta name="generator" content="Jekyll v4.3.1" /> <meta property="og:title" content="Assembler “as-8080”" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="User documentation for emuStudio 0.41. emuStudio is universal emulation platform and framework targeting mainly academic sphere." /> <meta property="og:description" content="User documentation for emuStudio 0.41. emuStudio is universal emulation platform and framework targeting mainly academic sphere." /> <link rel="canonical" href="/documentation/user/altair8800/as-8080" /> <meta property="og:url" content="/documentation/user/altair8800/as-8080" /> <meta property="og:site_name" content="User documentation for emuStudio" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Assembler “as-8080”" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"User documentation for emuStudio 0.41. emuStudio is universal emulation platform and framework targeting mainly academic sphere.","headline":"Assembler “as-8080”","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/documentation/user/assets/logo-1.svg"}},"url":"/documentation/user/altair8800/as-8080"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/documentation/user/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/documentation/user/introduction/" class="nav-list-link">Introduction</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in emuStudio Application category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/user/application/" class="nav-list-link">emuStudio Application</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/user/application/configuration-file" class="nav-list-link">Configuration file</a></li><li class="nav-list-item "><a href="/documentation/user/application/opening-computer" class="nav-list-link">Opening a computer</a></li><li class="nav-list-item "><a href="/documentation/user/application/computer-schema" class="nav-list-link">Computer schema</a></li><li class="nav-list-item "><a href="/documentation/user/application/main-window" class="nav-list-link">Main window</a></li><li class="nav-list-item "><a href="/documentation/user/application/automation" class="nav-list-link">Automation</a></li><li class="nav-list-item "><a href="/documentation/user/application/logging" class="nav-list-link">Logging</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in MITS Altair8800 category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/user/altair8800/" class="nav-list-link">MITS Altair8800</a><ul class="nav-list "><li class="nav-list-item active"><a href="/documentation/user/altair8800/as-8080" class="nav-list-link active">Assembler "as-8080"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/as-z80" class="nav-list-link">Assembler "as-z80"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/8080-cpu" class="nav-list-link">CPU "8080-cpu"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/z80-cpu" class="nav-list-link">CPU "z80-cpu"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/byte-mem" class="nav-list-link">Memory "byte-mem"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/88-dcdd" class="nav-list-link">Device "88-dcdd"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/88-sio" class="nav-list-link">Device "88-sio"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/adm3a-terminal" class="nav-list-link">Device "adm3a-terminal"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/simh-pseudo" class="nav-list-link">Device "simh-pseudo"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/automation" class="nav-list-link">Automation</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/software" class="nav-list-link">Original software</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in BrainDuck category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/user/brainduck/" class="nav-list-link">BrainDuck</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/user/brainduck/compiler" class="nav-list-link">Compiler "brainc-brainduck"</a></li><li class="nav-list-item "><a href="/documentation/user/brainduck/cpu" class="nav-list-link">CPU "brainduck-cpu"</a></li><li class="nav-list-item "><a href="/documentation/user/brainduck/terminal" class="nav-list-link">Terminal "vt100-terminal"</a></li><li class="nav-list-item "><a href="/documentation/user/brainduck/automation" class="nav-list-link">Automation</a></li><li class="nav-list-item "><a href="/documentation/user/brainduck/examples" class="nav-list-link">Example code</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in RAM category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/user/ram/" class="nav-list-link">RAM</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/user/ram/ramc-ram" class="nav-list-link">Compiler "ramc-ram"</a></li><li class="nav-list-item "><a href="/documentation/user/ram/ram-cpu" class="nav-list-link">CPU "ram-cpu"</a></li><li class="nav-list-item "><a href="/documentation/user/ram/ram-mem" class="nav-list-link">Memory "ram-mem"</a></li><li class="nav-list-item "><a href="/documentation/user/ram/abstract-tape" class="nav-list-link">Abstract tape</a></li><li class="nav-list-item "><a href="/documentation/user/ram/automation" class="nav-list-link">Automation</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in RASP category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/user/rasp/" class="nav-list-link">RASP</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/user/rasp/raspc-rasp" class="nav-list-link">Compiler "raspc-rasp"</a></li><li class="nav-list-item "><a href="/documentation/user/rasp/rasp-cpu" class="nav-list-link">CPU "rasp-cpu"</a></li><li class="nav-list-item "><a href="/documentation/user/rasp/rasp-mem" class="nav-list-link">Memory "rasp-mem"</a></li><li class="nav-list-item "><a href="/documentation/user/rasp/automation" class="nav-list-link">Automation</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in SSEM category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/user/ssem/" class="nav-list-link">SSEM</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/user/ssem/as-ssem" class="nav-list-link">Assembler "as-ssem"</a></li><li class="nav-list-item "><a href="/documentation/user/ssem/ssem-cpu" class="nav-list-link">CPU "ssem-cpu"</a></li><li class="nav-list-item "><a href="/documentation/user/ssem/ssem-mem" class="nav-list-link">Memory "ssem-mem"</a></li><li class="nav-list-item "><a href="/documentation/user/ssem/ssem-display" class="nav-list-link">Display "ssem-display"</a></li><li class="nav-list-item "><a href="/documentation/user/ssem/automation" class="nav-list-link">Automation</a></li><li class="nav-list-item "><a href="/documentation/user/ssem/software" class="nav-list-link">Software for SSEM</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search User documentation for emuStudio" aria-label="Search User documentation for emuStudio" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="/" class="site-button" > Back to website </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/documentation/user/altair8800/">MITS Altair8800</a></li> <li class="breadcrumb-nav-list-item"><span>Assembler "as-8080"</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <script type="text/javascript"> gtag('event', 'userdoc', { 'event_category': 'Altair8800', 'event_label': 'Assembler "as-8080"' }); </script> <h1 id="assembler-as-8080"> <a href="#assembler-as-8080" class="anchor-heading" aria-labelledby="assembler-as-8080"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Assembler “as-8080” </h1> <p>emuStudio version of assembler for Intel 8080 CPU is very similar to <a href="http://altairclone.com/downloads/manuals/8080%20Programmers%20Manual.pdf" target="_blank">Intel assembler</a>, but has some little differences. Features include:</p> <ul> <li>macros (unlimited nesting)</li> <li>include files support</li> <li>data definition</li> <li>relative addressing using labels</li> <li>literals and expressions in various radixes (bin, dec, hex, oct)</li> <li>compiler output is in <a href="https://en.wikipedia.org/wiki/Intel_HEX" target="_blank">Intel HEX</a> format</li> </ul> <p>The features are very similar to those in “as-z80” assembler.</p> <h2 id="running-from-command-line"> <a href="#running-from-command-line" class="anchor-heading" aria-labelledby="running-from-command-line"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running from command line </h2> <p>The assembler is provided as part of emuStudio, and usually it is run from GUI. But it can be run also from the command line, as follows:</p> <ul> <li>on Linux: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; bin/as-8080 [--output output_file.hex] [source_file.asm]
</code></pre></div> </div> </li> <li>on Windows: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; bin\as-8080.bat [--output output_file.hex] [source_file.asm]
</code></pre></div> </div> </li> </ul> <p>All command line options include:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Options:
	--output, -o	file: name of the output file
	--version, -v	: print version
	--help, -h	: this help
</code></pre></div></div> <h2 id="lexical-symbols"> <a href="#lexical-symbols" class="anchor-heading" aria-labelledby="lexical-symbols"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lexical symbols </h2> <p>The assembler does not differentiate between upper and lower case (it is case-insensitive). The token/symbol types are as follows:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>Keywords</td> <td>instruction names; preprocessor directives (<code class="language-plaintext highlighter-rouge">org</code>, <code class="language-plaintext highlighter-rouge">equ</code>, <code class="language-plaintext highlighter-rouge">set</code>, <code class="language-plaintext highlighter-rouge">macro</code>, <code class="language-plaintext highlighter-rouge">endm</code>, <code class="language-plaintext highlighter-rouge">include</code>, <code class="language-plaintext highlighter-rouge">if</code>, <code class="language-plaintext highlighter-rouge">endif</code>); data definitions (<code class="language-plaintext highlighter-rouge">db</code>, <code class="language-plaintext highlighter-rouge">dw</code>, <code class="language-plaintext highlighter-rouge">ds</code>); CPU registers</td> </tr> <tr> <td>Identifiers</td> <td><code class="language-plaintext highlighter-rouge">([a-zA-Z_\?@])[a-zA-Z_\?@0-9]*</code> except keywords</td> </tr> <tr> <td>Labels</td> <td> </td> </tr> <tr> <td>Constants</td> <td>strings or integers</td> </tr> <tr> <td>Operators</td> <td><code class="language-plaintext highlighter-rouge">+</code>, <code class="language-plaintext highlighter-rouge">-</code>, <code class="language-plaintext highlighter-rouge">*</code>, <code class="language-plaintext highlighter-rouge">/</code>, <code class="language-plaintext highlighter-rouge">=</code>, <code class="language-plaintext highlighter-rouge">mod</code>, <code class="language-plaintext highlighter-rouge">and</code>, <code class="language-plaintext highlighter-rouge">or</code>, <code class="language-plaintext highlighter-rouge">not</code>, <code class="language-plaintext highlighter-rouge">xor</code>, <code class="language-plaintext highlighter-rouge">shl</code>, <code class="language-plaintext highlighter-rouge">shr</code></td> </tr> <tr> <td>Comments</td> <td>semi-colon (<code class="language-plaintext highlighter-rouge">;</code>) with text after it until the end of the line</td> </tr> </tbody> </table></div> <h3 id="constants"> <a href="#constants" class="anchor-heading" aria-labelledby="constants"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Constants </h3> <p>Numeric constants can be only integers, encoded with one of several number radixes. The possible formats are written using regexes:</p> <ul> <li>binary numbers: <code class="language-plaintext highlighter-rouge">[0-1]+[bB]</code></li> <li>decimal numbers: <code class="language-plaintext highlighter-rouge">[0-9]+[dD]?</code></li> <li>octal numbers: <code class="language-plaintext highlighter-rouge">[0-7]+[oOqQ]</code></li> <li>hexadecimal numbers: <code class="language-plaintext highlighter-rouge">[0-9][0-9a-fA-F]*[hH]</code> or <code class="language-plaintext highlighter-rouge">0[xX][0-9a-fA-F]+</code></li> </ul> <p>Characters or strings must be enclosed in single-quotes, e,g,: <code class="language-plaintext highlighter-rouge">MVI E, '*'</code></p> <h3 id="identifiers"> <a href="#identifiers" class="anchor-heading" aria-labelledby="identifiers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Identifiers </h3> <p>Identifiers must fit to the following regex: <code class="language-plaintext highlighter-rouge">([a-zA-Z_\?@])[a-zA-Z_\?@0-9]*</code>. It means, that it has to start with a letter a-z (or A-Z) or the at-sign (<code class="language-plaintext highlighter-rouge">@</code>). Then, it can be followed by letters, at-sign, or numbers.</p> <p>However, they must not equal to any keyword.</p> <p>Also, if an identifier is used for one kind of definition (label, variable, constant, or macro), it cannot be used for definition of another kind. For example, the following code is not valid</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>label:
label set 1
</code></pre></div></div> <p>At first the identified <code class="language-plaintext highlighter-rouge">label</code> is used for definition of a label, and on the second row the same identifier is used for definition of a variable. This is not allowed and will produce an error.</p> <h2 id="instructions-syntax"> <a href="#instructions-syntax" class="anchor-heading" aria-labelledby="instructions-syntax"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Instructions syntax </h2> <p>The program is basically a sequence of instructions. The instructions are separated by a new line. The instruction have optional and mandatory parts, e.g.:</p> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LABEL: CODE OPERANDS ; COMMENT
</code></pre></div></div> <div class="table-wrapper"><table> <thead> <tr> <th>Syntax part</th> <th>Required</th> <th>Notes</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">LABEL</code></td> <td>Optional</td> <td>Identifier of the memory position, followed by a colon (<code class="language-plaintext highlighter-rouge">:</code>).</td> </tr> <tr> <td> </td> <td>It can be used as forward or backward reference in instructions</td> <td> </td> </tr> <tr> <td> </td> <td>which expect memory address (or 16 bit number).</td> <td> </td> </tr> </tbody> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">CODE</code></td> <td>Mandatory</td> <td>Instruction name.</td> </tr> </tbody> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">OPERANDS</code></td> <td>It depends</td> <td>If applicable, a comma-separated (<code class="language-plaintext highlighter-rouge">,</code>) operands of the instruction.</td> </tr> </tbody> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">COMMENT</code></td> <td>Optional</td> <td>semi-colonm (<code class="language-plaintext highlighter-rouge">;</code>) followed by any text until the end of the line.</td> </tr> </tbody> </table></div> <p>Fields <code class="language-plaintext highlighter-rouge">CODE</code> and <code class="language-plaintext highlighter-rouge">OPERANDS</code> must be separated by at least one space. For example:</p> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HERE:   MVI C, 0  ; Put 0 into C register
        DB 3Ah    ; Data constant of size 1 byte
LOOP:   JMP LOOP  ; Infinite loop
</code></pre></div></div> <p>Labels are optional. Instructions and pseudo-instructions and register names are reserved for assembler and cannot be used as labels. Also, there cannot be more definitions of the same label.</p> <p>Operands must be separated with comma (<code class="language-plaintext highlighter-rouge">,</code>). There exist several operand types, which represent so-called “address modes”. Allowed address modes depend on the instruction. The possibilities are:</p> <ul> <li>Implicit addressing: instructions do not have operands. They are implicit.</li> <li>Register addressing: operands are registers. 8-bit general-purpose register names are: <code class="language-plaintext highlighter-rouge">A</code>, <code class="language-plaintext highlighter-rouge">B</code>, <code class="language-plaintext highlighter-rouge">C</code>, <code class="language-plaintext highlighter-rouge">D</code>, <code class="language-plaintext highlighter-rouge">E</code>, <code class="language-plaintext highlighter-rouge">H</code> , <code class="language-plaintext highlighter-rouge">L</code>. Stack pointer is defined as <code class="language-plaintext highlighter-rouge">SP</code>, and program status word (used by <code class="language-plaintext highlighter-rouge">push</code> / <code class="language-plaintext highlighter-rouge">pop</code> instructions) as <code class="language-plaintext highlighter-rouge">PSW</code>. When register pairs should be used in 16-bit instructions, the same register names are used. For example, <code class="language-plaintext highlighter-rouge">DCX D</code> which decrements pair <code class="language-plaintext highlighter-rouge">DE</code>.</li> <li>Register indirect addressing: for the memory value specified by address in <code class="language-plaintext highlighter-rouge">HL</code> pair is used special register called <code class="language-plaintext highlighter-rouge">M</code>, for example: <code class="language-plaintext highlighter-rouge">MOV A, M</code>.</li> <li>Immediate addressing: operand is the 8-bit constant. It can be also one character, enclosed in single-quotes.</li> <li>Direct addressing: operand is either 8-bit or 16-bit constant, which is understood as the memory location (address). For example: <code class="language-plaintext highlighter-rouge">SHLD 1234h</code>.</li> <li>Modified page zero: operand is 3-bit value (0-7). It represents a “index”, which is multiplied by constant 8, resulting in final memory address. Used in <code class="language-plaintext highlighter-rouge">RST</code> instruction.</li> </ul> <p>Immediate data or addresses can be defined in various ways:</p> <ul> <li>Integer constant</li> <li>Integer constant as a result of evaluation of some expression (e.g. <code class="language-plaintext highlighter-rouge">2 SHL 4</code>, or <code class="language-plaintext highlighter-rouge">2 + 2</code>)</li> <li>Current address - denoted by special variable <code class="language-plaintext highlighter-rouge">$</code>. For example, instruction <code class="language-plaintext highlighter-rouge">JMP $+6</code> denotes a jump by 6-bytes further from the current address.</li> <li>Character constants, enclosed in single-quotes (e.g. <code class="language-plaintext highlighter-rouge">MVI A, '*'</code>)</li> <li>Labels. For example: <code class="language-plaintext highlighter-rouge">JMP THERE</code> will jump to the label <code class="language-plaintext highlighter-rouge">THERE</code>.</li> <li>Variables. For example:</li> </ul> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VALUE SET 'A'
MVI A, VALUE
</code></pre></div></div> <h2 id="expressions"> <a href="#expressions" class="anchor-heading" aria-labelledby="expressions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Expressions </h2> <p>An expression is a combination of the data constants and operators. Expressions are evaluated in compile-time. Given any two expressions, they must not be defined circularly. Expressions can be used anywhere a constant is expected.</p> <p>There exist several operators, such as:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Expression</th> <th>Notes</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">+</code></td> <td>Addition. Example: <code class="language-plaintext highlighter-rouge">DB 2 + 2</code>; evaluates to <code class="language-plaintext highlighter-rouge">DB 4</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">-</code></td> <td>Subtraction. Example: <code class="language-plaintext highlighter-rouge">DW $ - 2</code>; evaluates to the current compilation address minus 2.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">*</code></td> <td>Multiply.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">/</code></td> <td>Integer division.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">=</code></td> <td>Comparison for equality. Returns 1 if operands equal, 0 otherwise. Example: <code class="language-plaintext highlighter-rouge">DB 2 = 2</code>; evaluates to <code class="language-plaintext highlighter-rouge">DB 1</code>.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">mod</code></td> <td>Remainder after integer division. Example <code class="language-plaintext highlighter-rouge">DB 4 mod 3</code>; evaluates to <code class="language-plaintext highlighter-rouge">DB 1</code>.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">and</code></td> <td>Logical and.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">or</code></td> <td>Logical or.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">xor</code></td> <td>Logical xor.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">not</code></td> <td>Logical not.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">shl</code></td> <td>Shift left by 1 bit. Example: <code class="language-plaintext highlighter-rouge">DB 1 SHL 3</code>; evaluates to <code class="language-plaintext highlighter-rouge">DB 8</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">shr</code></td> <td>Shift right by 1 bit.</td> </tr> </tbody> </table></div> <p>Operator priorities are as follows:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Priority</th> <th>Operator</th> <th>Type</th> </tr> </thead> <tbody> <tr> <td>1</td> <td><code class="language-plaintext highlighter-rouge">( )</code></td> <td>Unary</td> </tr> <tr> <td>2</td> <td><code class="language-plaintext highlighter-rouge">*</code>, <code class="language-plaintext highlighter-rouge">/</code>, <code class="language-plaintext highlighter-rouge">mod</code>, <code class="language-plaintext highlighter-rouge">shl</code>, <code class="language-plaintext highlighter-rouge">shr</code></td> <td>Binary</td> </tr> <tr> <td>3</td> <td><code class="language-plaintext highlighter-rouge">+</code>, <code class="language-plaintext highlighter-rouge">-</code></td> <td>Unary and binary</td> </tr> <tr> <td>4</td> <td><code class="language-plaintext highlighter-rouge">=</code></td> <td>Binary</td> </tr> <tr> <td>5</td> <td><code class="language-plaintext highlighter-rouge">not</code></td> <td>Unary</td> </tr> <tr> <td>6</td> <td><code class="language-plaintext highlighter-rouge">and</code></td> <td>Binary</td> </tr> <tr> <td>7</td> <td><code class="language-plaintext highlighter-rouge">or</code>, <code class="language-plaintext highlighter-rouge">xor</code></td> <td>Binary</td> </tr> </tbody> </table></div> <p>All operators work with their arguments as if they were 16-bit. Their results are always 16-bit numbers. If there is expected an 8-bit number, the result is automatically “cut” using operation <code class="language-plaintext highlighter-rouge">result AND 0FFh</code>. This may be unwanted behavior and might lead to bugs, but it is often useful so the programmer must ensure the correctness.</p> <h2 id="defining-data"> <a href="#defining-data" class="anchor-heading" aria-labelledby="defining-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Defining data </h2> <p>Data can be defined using special pseudo-instructions. These accept constants. Negative integers are using <a href="https://en.wikipedia.org/wiki/Two's_complement" target="_blank">two’s complement</a>. The following table describes all possible data definition pseudo-instructions:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Expression</th> <th>Notes</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">DB [expression]</code></td> <td>Define byte. The <code class="language-plaintext highlighter-rouge">[expression]</code> must be of size 1 byte. Using this pseudo-instruction, a string can be defined, enclosed in single quotes. For example: <code class="language-plaintext highlighter-rouge">DB 'Hello, world!'</code> is equal to <code class="language-plaintext highlighter-rouge">DB 'H'</code>, <code class="language-plaintext highlighter-rouge">DB 'e'</code>, etc. on separate lines.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">DW [expression]</code></td> <td>Define word. The <code class="language-plaintext highlighter-rouge">[expression]</code> must be max. of size 2 bytes. Data are stored using <a href="https://en.wikipedia.org/wiki/Endianness#Little-endian" target="_blank">little endian</a>.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">DS [expression]</code></td> <td>Define storage. The <code class="language-plaintext highlighter-rouge">[expression]</code> represents number of bytes which should be “reserved”. The reserved space will not be modified in memory. It is similar to “skipping” particular number of bytes.</td> </tr> </tbody> </table></div> <h3 id="examples"> <a href="#examples" class="anchor-heading" aria-labelledby="examples"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Examples </h3> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HERE:  DB 0A3H          ; A3
W0RD1: DB 5*2, 2FH-0AH  ; 0A25
W0RD2: DB 5ABCH SHR 8   ; 5A
STR:   DB 'STRINGSpl'   ; 535452494E472031
MINUS: DB -03H          ; FD

ADD1: dw COMP          ; 1C3B  (assume COMP is 3B1CH)
ADD2: dw FILL          ; B43E (assume FILL is 3EB4H)
ADD3: dw 3C01H, 3CAEH  ; 013CAE3C
</code></pre></div></div> <h2 id="including-other-source-files"> <a href="#including-other-source-files" class="anchor-heading" aria-labelledby="including-other-source-files"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Including other source files </h2> <p>It is both useful and good practice to write modular programs. According to the <a href="https://en.wikipedia.org/wiki/Don't_repeat_yourself" target="_blank">DRY</a> principle, the repetitive parts of the program should be refactored out into functions or modules. Functionally similar groups of these functions or modules can be put into a library, reusable in other programs.</p> <p>The pseudo-instruction <code class="language-plaintext highlighter-rouge">include</code> exists for the purpose of including already written source code into the current program. The pseudo-instruction is defined as follows:</p> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INCLUDE '[filename]'
</code></pre></div></div> <p>where <code class="language-plaintext highlighter-rouge">[filename]</code> is a relative or absolute path to the file which will be included, enclosed in single-quotes. The file can include other files, but there must not be defined circular includes (the compiler will complain).</p> <p>The current address (denoted by <code class="language-plaintext highlighter-rouge">$</code> variable) below the <code class="language-plaintext highlighter-rouge">include</code> pseudo-instruction will be updated by the binary size of the included file.</p> <p>The namespace of the current program and the included file is <em>shared</em>. It means that labels or variables with the same name in the current program and the included file are prohibited. Include file “sees” everything in the current program as it was its part.</p> <h3 id="example"> <a href="#example" class="anchor-heading" aria-labelledby="example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example </h3> <p>Let <code class="language-plaintext highlighter-rouge">a.asm</code> contains:</p> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvi b, 80h
</code></pre></div></div> <p>Let <code class="language-plaintext highlighter-rouge">b.asm</code> contains:</p> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>include 'a.asm'
</code></pre></div></div> <p>Then compiling <code class="language-plaintext highlighter-rouge">b.asm</code> will result in:</p> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>06 80     ; mvi b, 80h
</code></pre></div></div> <h2 id="origin-address"> <a href="#origin-address" class="anchor-heading" aria-labelledby="origin-address"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Origin address </h2> <p>Syntax: <code class="language-plaintext highlighter-rouge">ORG [expression]</code></p> <p>Sets the value to the <code class="language-plaintext highlighter-rouge">$</code> variable. It means that from now on, the following instructions will be placed at the address given by the <code class="language-plaintext highlighter-rouge">[expression]</code>. Effectively, it is the same as using <code class="language-plaintext highlighter-rouge">DS</code> pseudo-instruction, but instead of defining the number of skipped bytes, we define concrete memory location (address).</p> <p>The following two code snippets are equal:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Address</th> <th>Block 1</th> <th>Block 2</th> <th>Opcode</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">2C00</code></td> <td><code class="language-plaintext highlighter-rouge">MOV A,C</code></td> <td><code class="language-plaintext highlighter-rouge">MOV A,C</code></td> <td><code class="language-plaintext highlighter-rouge">79</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">2C01</code></td> <td><code class="language-plaintext highlighter-rouge">JMP NEXT</code></td> <td><code class="language-plaintext highlighter-rouge">JMP NEXT</code></td> <td><code class="language-plaintext highlighter-rouge">C3 10 2C</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">2C04</code></td> <td><code class="language-plaintext highlighter-rouge">DS 12</code></td> <td><code class="language-plaintext highlighter-rouge">ORG $+12</code></td> <td> </td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">2C10</code></td> <td><code class="language-plaintext highlighter-rouge">NEXT: XRA A</code></td> <td><code class="language-plaintext highlighter-rouge">NEXT: XRA A</code></td> <td><code class="language-plaintext highlighter-rouge">AF</code></td> </tr> </tbody> </table></div> <h2 id="equate"> <a href="#equate" class="anchor-heading" aria-labelledby="equate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Equate </h2> <p>Syntax: <code class="language-plaintext highlighter-rouge">[identifier] EQU [expression]</code></p> <p>Define a constant. The <code class="language-plaintext highlighter-rouge">[identifier]</code> is a mandatory name of the constant.</p> <p><code class="language-plaintext highlighter-rouge">[expression]</code> is the 16-bit expression.</p> <p>The pseudo-instruction will define a constant - assign a name to the given expression. The name of the constant then can be used anywhere where the constant is expected and the compiler will replace it with the expression.</p> <p>It is not possible to redefine a constant.</p> <h2 id="variables"> <a href="#variables" class="anchor-heading" aria-labelledby="variables"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Variables </h2> <p>Syntax: <code class="language-plaintext highlighter-rouge">[identifier] SET [expression]</code></p> <p>Define or re-define a variable. The <code class="language-plaintext highlighter-rouge">[identifier]</code> is a mandatory name of the constant.</p> <p><code class="language-plaintext highlighter-rouge">[expression]</code> is the 16-bit expression.</p> <p>The pseudo-instruction will define a variable - assign a name to the given expression. Then, the name of the variable can be used anywhere where the constant is expected.</p> <p>It is possible to redefine a variable. This effectively means to reassign a new expression to the same name and forgetting the old one. The reassignment is aware of locality, i.e. before the operation, the old value will be used, and after the operation, the new value will be used.</p> <h2 id="conditional-assembly"> <a href="#conditional-assembly" class="anchor-heading" aria-labelledby="conditional-assembly"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Conditional assembly </h2> <p>Syntax:</p> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if [expression]
    i n s t r u c t i o n s
endif
</code></pre></div></div> <p>At first, the compiler evaluates the <code class="language-plaintext highlighter-rouge">[expression]</code>. If the result is 0, statements between <code class="language-plaintext highlighter-rouge">if</code> and <code class="language-plaintext highlighter-rouge">endif</code> are ignored.</p> <p>Labels defined inside the <code class="language-plaintext highlighter-rouge">if</code> block occupy the namespace even if the if-expression evaluates to 0. Hence, the following code yields an error (<code class="language-plaintext highlighter-rouge">Label already defined</code>):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if 0
  label1: stax b
endif
label1: hlt 
</code></pre></div></div> <p>Evaluation of the expression in the <code class="language-plaintext highlighter-rouge">if</code> statement must not use forward references. For example, the following code is not valid (will produce an error):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if variable
  stax b
endif
variable set $
</code></pre></div></div> <p>In this case, variable is about to be set to current address, which would be 0 if the <code class="language-plaintext highlighter-rouge">if</code> statement evaluates to <code class="language-plaintext highlighter-rouge">false</code>. Otherwise, it evaluates to <code class="language-plaintext highlighter-rouge">1</code>. Both options would be semantically correct, and the compiler cannot know what was the programmer’s intention.</p> <h2 id="defining-and-using-macros"> <a href="#defining-and-using-macros" class="anchor-heading" aria-labelledby="defining-and-using-macros"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Defining and using macros </h2> <p>Syntax:</p> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[identifier] macro [operands]
    i n s t r u c t i o n s
endm
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">[identifier]</code> is a mandatory name of the macro.</p> <p>The <code class="language-plaintext highlighter-rouge">[operands]</code> part is a list of identifiers, separated by commas (<code class="language-plaintext highlighter-rouge">,</code>). Inside the macro, operands act as constants. If the macro does not use any operands, this part can be omitted.</p> <p>The namespace of the operand identifiers is macro-local, ie. the operand names will not be visible outside the macro. Also, the operand names can hide variables, labels, or constants defined in the outer scope.</p> <p>The macros can be understood as “templates” which will be expanded in the place where they are “called”. The call syntax is as follows:</p> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[macro name] [arguments]
</code></pre></div></div> <p>where <code class="language-plaintext highlighter-rouge">[macro name]</code> is the macro name as defined above. Then, <code class="language-plaintext highlighter-rouge">[arguments]</code> are comma-separated expressions, in the order as the original operands are defined. The number of arguments must be the same as the number of macro operands.</p> <p>The macro can be defined anywhere in the program, even in any included file. Also, it does not matter in which place is called - above or below the macro definition.</p> <h3 id="examples-1"> <a href="#examples-1" class="anchor-heading" aria-labelledby="examples-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Examples </h3> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHV MACRO
LOOP: RRC      ; Right rotate with carry
      ANI 7FH  ; Clear MSB of accumulator
      DCR D    ; Decrement rotation counter - register D
      JNZ LOOP ; Jump to next rotation
ENDM
</code></pre></div></div> <p>The macro <code class="language-plaintext highlighter-rouge">SHV</code> can be used as follows:</p> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LDA TEMP
MVI D,3  ; 3 rotations
SHV
STA TEMP
</code></pre></div></div> <p>Or another definition:</p> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHV MACRO AMT
      MVI D,AMT   ; Number of rotations
LOOP: RRC
      ANI 7FH
      DCR D
      JNZ LOOP
ENDM
</code></pre></div></div> <p>And usage:</p> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LDA TEMP
SHV 5
</code></pre></div></div> <p>Which has the same effect as the previous example.</p> </div> </div> <div class="search-overlay"></div> </div> <script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script> </body> </html>
