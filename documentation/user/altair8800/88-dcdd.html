<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Device "88-dcdd" - User documentation for emuStudio</title> <link rel="shortcut icon" href="/documentation/user/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/documentation/user/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3492956-5"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-3492956-5', { 'anonymize_ip': true }); </script> <script src="/documentation/user/assets/js/vendor/lunr.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script src="/documentation/user/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Device “88-dcdd” | User documentation for emuStudio</title> <meta name="generator" content="Jekyll v4.3.1" /> <meta property="og:title" content="Device “88-dcdd”" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="User documentation for emuStudio 0.41. emuStudio is universal emulation platform and framework targeting mainly academic sphere." /> <meta property="og:description" content="User documentation for emuStudio 0.41. emuStudio is universal emulation platform and framework targeting mainly academic sphere." /> <link rel="canonical" href="/documentation/user/altair8800/88-dcdd" /> <meta property="og:url" content="/documentation/user/altair8800/88-dcdd" /> <meta property="og:site_name" content="User documentation for emuStudio" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Device “88-dcdd”" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"User documentation for emuStudio 0.41. emuStudio is universal emulation platform and framework targeting mainly academic sphere.","headline":"Device “88-dcdd”","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/documentation/user/assets/logo-1.svg"}},"url":"/documentation/user/altair8800/88-dcdd"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/documentation/user/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/documentation/user/introduction/" class="nav-list-link">Introduction</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in emuStudio Application category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/user/application/" class="nav-list-link">emuStudio Application</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/user/application/configuration-file" class="nav-list-link">Configuration file</a></li><li class="nav-list-item "><a href="/documentation/user/application/opening-computer" class="nav-list-link">Opening a computer</a></li><li class="nav-list-item "><a href="/documentation/user/application/computer-schema" class="nav-list-link">Computer schema</a></li><li class="nav-list-item "><a href="/documentation/user/application/main-window" class="nav-list-link">Main window</a></li><li class="nav-list-item "><a href="/documentation/user/application/automation" class="nav-list-link">Automation</a></li><li class="nav-list-item "><a href="/documentation/user/application/logging" class="nav-list-link">Logging</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in MITS Altair8800 category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/user/altair8800/" class="nav-list-link">MITS Altair8800</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/user/altair8800/as-8080" class="nav-list-link">Assembler "as-8080"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/as-z80" class="nav-list-link">Assembler "as-z80"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/8080-cpu" class="nav-list-link">CPU "8080-cpu"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/z80-cpu" class="nav-list-link">CPU "z80-cpu"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/byte-mem" class="nav-list-link">Memory "byte-mem"</a></li><li class="nav-list-item active"><a href="/documentation/user/altair8800/88-dcdd" class="nav-list-link active">Device "88-dcdd"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/88-sio" class="nav-list-link">Device "88-sio"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/adm3a-terminal" class="nav-list-link">Device "adm3a-terminal"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/simh-pseudo" class="nav-list-link">Device "simh-pseudo"</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/software" class="nav-list-link">Original software</a></li><li class="nav-list-item "><a href="/documentation/user/altair8800/automation" class="nav-list-link">Automation</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in BrainDuck category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/user/brainduck/" class="nav-list-link">BrainDuck</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/user/brainduck/compiler" class="nav-list-link">Compiler "brainc-brainduck"</a></li><li class="nav-list-item "><a href="/documentation/user/brainduck/cpu" class="nav-list-link">CPU "brainduck-cpu"</a></li><li class="nav-list-item "><a href="/documentation/user/brainduck/terminal" class="nav-list-link">Terminal "vt100-terminal"</a></li><li class="nav-list-item "><a href="/documentation/user/brainduck/examples" class="nav-list-link">Example code</a></li><li class="nav-list-item "><a href="/documentation/user/brainduck/automation" class="nav-list-link">Automation</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in RAM category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/user/ram/" class="nav-list-link">RAM</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/user/ram/ramc-ram" class="nav-list-link">Compiler "ramc-ram"</a></li><li class="nav-list-item "><a href="/documentation/user/ram/ram-cpu" class="nav-list-link">CPU "ram-cpu"</a></li><li class="nav-list-item "><a href="/documentation/user/ram/ram-mem" class="nav-list-link">Memory "ram-mem"</a></li><li class="nav-list-item "><a href="/documentation/user/ram/abstract-tape" class="nav-list-link">Abstract tape</a></li><li class="nav-list-item "><a href="/documentation/user/ram/automation" class="nav-list-link">Automation</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in RASP category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/user/rasp/" class="nav-list-link">RASP</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/user/rasp/raspc-rasp" class="nav-list-link">Compiler "raspc-rasp"</a></li><li class="nav-list-item "><a href="/documentation/user/rasp/rasp-cpu" class="nav-list-link">CPU "rasp-cpu"</a></li><li class="nav-list-item "><a href="/documentation/user/rasp/rasp-mem" class="nav-list-link">Memory "rasp-mem"</a></li><li class="nav-list-item "><a href="/documentation/user/rasp/automation" class="nav-list-link">Automation</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in SSEM category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/user/ssem/" class="nav-list-link">SSEM</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/user/ssem/as-ssem" class="nav-list-link">Assembler "as-ssem"</a></li><li class="nav-list-item "><a href="/documentation/user/ssem/ssem-cpu" class="nav-list-link">CPU "ssem-cpu"</a></li><li class="nav-list-item "><a href="/documentation/user/ssem/ssem-mem" class="nav-list-link">Memory "ssem-mem"</a></li><li class="nav-list-item "><a href="/documentation/user/ssem/ssem-display" class="nav-list-link">Display "ssem-display"</a></li><li class="nav-list-item "><a href="/documentation/user/ssem/software" class="nav-list-link">Software for SSEM</a></li><li class="nav-list-item "><a href="/documentation/user/ssem/automation" class="nav-list-link">Automation</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search User documentation for emuStudio" aria-label="Search User documentation for emuStudio" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="/" class="site-button" > Back to website </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/documentation/user/altair8800/">MITS Altair8800</a></li> <li class="breadcrumb-nav-list-item"><span>Device "88-dcdd"</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <script type="text/javascript"> gtag('event', 'userdoc', { 'event_category': 'Altair8800', 'event_label': 'Device "88-dcdd"' }); </script> <h1 id="altair-floppy-disk-88-dcdd"> <a href="#altair-floppy-disk-88-dcdd" class="anchor-heading" aria-labelledby="altair-floppy-disk-88-dcdd"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Altair Floppy Disk (88-DCDD) </h1> <p><a href="http://vtda.org/docs/computing/MITS/MITS_AltairFloppyDisk88-DCDD_Specs.pdf" target="_blank">Altair floppy disk</a> (88-DCDD) offered the advantage of permanent store including relatively fast access to data. The speed of data transfer was 250 Kbit/s (The plugin does not emulate this). Data transfer was serial, byte after byte.</p> <p><img src="/documentation/user/assets/altair8800/altair-disk.jpg" alt="Altair disk" /></p> <p>(The image was borrowed from <a href="https://deramp.com/altair.html" target="_blank">deramp.com</a>).</p> <p>The 88-DCDD hardware contained three parts:</p> <ul> <li>disk drive (initially <a href="http://cini.classiccmp.org/pdf/iCOM/FD400-5x0-5x1_Mar77.pdf" target="_blank">Pertec FD400</a>), able to store ~330 kB of data on 8” diskette</li> <li>two boards connected to S-100 bus <ul> <li>the first one performed communication operations between the bus and CPU</li> <li>the second one performed communication with the disk drives</li> </ul> </li> </ul> <p>Original manual can be found at <a href="https://deramp.com/downloads/mfe_archive/010-S100%20Computers%20and%20Boards/00-MITS/30-Disk%20Storage%20Devices/20-88-DCDD%208%20inch%20Floppy%20System/Other%20Manual%20Scans/Altair%2088-DCDD%20Disk%20Drive%20System.pdf" target="_blank">deramp.com</a> or <a href="http://www.virtualaltair.com/virtualaltair.com/PDF/88dsk%20manual%20v2.pdf" target="_blank">www.virtualaltair.com</a>.</p> <h2 id="diskette-formats"> <a href="#diskette-formats" class="anchor-heading" aria-labelledby="diskette-formats"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Diskette formats </h2> <p>A diskette was introduced by <a href="https://en.wikipedia.org/wiki/History_of_the_floppy_disk" target="_blank">IBM in 1971</a> for being able to load programs into IBM mainframes. Soon a revolution in personal computers brought diskettes into the world of microcomputers.</p> <p><img src="/documentation/user/assets/altair8800/altair-diskette.png" alt="IBM diskette" /></p> <p>Standard Altair 8” diskette had the following parameters:</p> <div class="table-wrapper"><table class="table-responsive table table-stripped"> <thead> <tr> <th>Description</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Maximum capacity</td> <td>330 kB</td> </tr> <tr> <td>Recording density</td> <td>6331 bits per radian (3268 bits per inch)</td> </tr> <tr> <td>Tracks</td> <td>77</td> </tr> <tr> <td>Sectors per track</td> <td>32</td> </tr> <tr> <td>Sector size</td> <td>137 bytes</td> </tr> </tbody> </table></div> <p>(info from <a href="http://cini.classiccmp.org/pdf/iCOM/FD400-5x0-5x1_Mar77.pdf" target="_blank">Pertec FD400</a> manual, <a href="https://sectordisk.pw/?doc/sectorstracksbytes" target="_blank">this blogpost</a> and <a href="https://github.com/open-simh/simh/blob/master/AltairZ80/altairz80_dsk.c" target="_blank">simh</a> emulator)</p> <h2 id="features-of-the-plugin"> <a href="#features-of-the-plugin" class="anchor-heading" aria-labelledby="features-of-the-plugin"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Features of the plugin </h2> <p>The <code class="language-plaintext highlighter-rouge">88-dcdd</code> plugin emulates basic functionality of the whole disk system for Altair 8800 computer. It is not only disk controller, but also includes 16 disk drives.</p> <p>Feature highlights are:</p> <ul class="task-list"> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Up to 16 disk images can be mounted, optionally mounted automatically on startup</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />CPU ports can be set manually</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />GUI showing disk activity in runtime</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Interrupts are supported</li> </ul> <p>GUI can be seen in the following image:</p> <p><img src="/documentation/user/assets/altair8800/88-dcdd.png" alt="GUI of 88-DCDD" /></p> <p>The window shows runtime status of virtual disk drives. By clicking on a drive button, its details are revealed below. Port1 is showing 88-dcdd status, ordered from the MSB to LSB, and instead of showing 1 and 0s, every bit is mapped to a letter:</p> <ul> <li><code class="language-plaintext highlighter-rouge">R</code> (bit 7): “New read data” available - indicates that one byte of data is available to be read from port 2</li> <li><code class="language-plaintext highlighter-rouge">Z</code> (bit 6): Indicates when head is on outermost track (track 0)</li> <li><code class="language-plaintext highlighter-rouge">I</code> (bit 5): Indicates interrupts enabled (value=0) or disabled (value=1)</li> <li><code class="language-plaintext highlighter-rouge">H</code> (bit 2): Head status (loaded: value=0, unloaded: value=1)</li> <li><code class="language-plaintext highlighter-rouge">M</code> (bit 1): Indicates head movement allowed (allowed: value=0, disallowed: value=1)</li> <li><code class="language-plaintext highlighter-rouge">W</code> (bit 0): “Enter new write data” - indicates new byte of data can be written to port 2</li> </ul> <p>You might notice on “true” condition the bit value of Port 1 is 0. Also, the drive button icon color reflects the head status: green means head is loaded, red means head is unloaded. See <a href="https://deramp.com/downloads/mfe_archive/010-S100%20Computers%20and%20Boards/00-MITS/30-Disk%20Storage%20Devices/20-88-DCDD%208%20inch%20Floppy%20System/Other%20Manual%20Scans/Altair%2088-DCDD%20Disk%20Drive%20System.pdf" target="_blank">88-dcdd manual</a> for more details.</p> <h2 id="mounting-disk-images"> <a href="#mounting-disk-images" class="anchor-heading" aria-labelledby="mounting-disk-images"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mounting disk images </h2> <p>In order to mount disk images to the device, please open device settings:</p> <p><img src="/documentation/user/assets/altair8800/88-dcdd-settings1.png" alt="Settings window of 88-DCDD" /></p> <div class="table-wrapper"><table class="list"> <tbody> <tr> <td><span class="circle">1</span></td> <td>Select drive (A - P)</td> </tr> <tr> <td><span class="circle">2</span></td> <td>Choose the image file and click on “Mount”. If there is a disk mounted already, it will be re-mounted with the new file.</td> </tr> <tr> <td><span class="circle">3</span></td> <td>If you want to un-mount all disk drives, click on “Umount all” button</td> </tr> <tr> <td><span class="circle">4</span></td> <td>Set sectors per track and sector size for the current drive. (NOTE: Be cautious with the settings. Incorrect values can result in disk image file damage. Existing default values were chosen from disk image files used by <a href="http://simh.trailing-edge.com/" target="_blank">simh</a> emulator).</td> </tr> <tr> <td><span class="circle">5</span></td> <td>Set default values for sectors per track and sector size for the current drive.</td> </tr> </tbody> </table></div> <h2 id="cpu-ports-settings"> <a href="#cpu-ports-settings" class="anchor-heading" aria-labelledby="cpu-ports-settings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> CPU Ports settings </h2> <p>A control board of Altair disk communicates with CPU through its ports. There are three ports overall, each for different function. By default, the port mapping to CPU port numbers is as follows:</p> <ul> <li>Port 1: <code class="language-plaintext highlighter-rouge">0x08</code> - in: disk status information, out: select disk</li> <li>Port 2: <code class="language-plaintext highlighter-rouge">0x09</code> - in: get number of sector, out: disk settings</li> <li>Port 3: <code class="language-plaintext highlighter-rouge">0x0A</code> - in: read data, out: write data</li> </ul> <p>Port mapping can be changed in the Settings window, tab “CPU Ports”:</p> <p><img src="/documentation/user/assets/altair8800/88-dcdd-settings2.png" alt="Setting CPU ports" /></p> <div class="table-wrapper"><table class="list"> <tbody> <tr> <td><span class="circle">1</span></td> <td>Set CPU port number value for the three 88-dcdd ports</td> </tr> <tr> <td><span class="circle">2</span></td> <td>Set used CPU interrupt vector and whether interrupts are actually supported by 88-dcdd. Interrupt vector is used when interrupt is signalled to the CPU which is implemented as equivalent to executing an instruction <code class="language-plaintext highlighter-rouge">RST</code>. When interrupts are globally disabled here, enabling them in runtime won’t work.</td> </tr> <tr> <td><span class="circle">3</span></td> <td>Setting default interrupt vector (which is 7)</td> </tr> </tbody> </table></div> <h2 id="programming"> <a href="#programming" class="anchor-heading" aria-labelledby="programming"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Programming </h2> <p>The basic idea is to programmatically select a drive, then set a “position”. After that data can be either read or written. For nice introduction with historical context see <a href="https://sectordisk.pw/?doc/sectorstracksbytes" target="_blank">this nice blog post</a>.</p> <p>The “position” in the floppy disk is determined by a track number, sector number and the offset within the sector. It is rudimentary to know how many tracks are available, so as how many sectors per track and the sector size.</p> <p>In Altair8800, drive <code class="language-plaintext highlighter-rouge">Pertec FD400</code> used 8” diskettes. Each had 77 tracks. A track had 32 sectors with 137 bytes long. The capacity of a diskette was therefore <code class="language-plaintext highlighter-rouge">77 * 32 * 137 = 337568 B = 330 kB</code>. Software used less capacity, because 9 bytes of each sector were used for the integrity checksum.</p> <h3 id="setting-the-position"> <a href="#setting-the-position" class="anchor-heading" aria-labelledby="setting-the-position"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Setting the position </h3> <p>In the original device, the position was changing automatically by the diskette rotation inside the disk drive. Since CPU was much faster than a rotation, the idea was to probe the current drive position (track and sector number) from the CPU and when the position matched the requested one, data could be read or written.</p> <p>emuStudio plugin does this in a more predictable way. Instead of automatic changing the position asynchronously, it is changed in time when a programmer actually performs the probing. For example, to set the sector number to - say - 5, the programmer must probe the sector 5 times.</p> <p>Setting the offset within a sector is more challenging. After the track and sector are set, programmer must - again - probe the status port telling if current disk position is actually set at the beginning of the sector. If so, then a programmer must read the data until which increments the position, until the position is as requested.</p> <h3 id="cpu-ports"> <a href="#cpu-ports" class="anchor-heading" aria-labelledby="cpu-ports"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> CPU Ports </h3> <p>In the real world, two controller boards communicated with CPU using three I/O ports. The plugin utilizes the ports the same way as the real device. The following table shows the CPU ports and how they are used.</p> <div class="table-wrapper"><table> <thead> <tr> <th>Port</th> <th>Address</th> <th>Input</th> <th>Output</th> </tr> </thead> <tbody> <tr> <td>1</td> <td><code class="language-plaintext highlighter-rouge">0x08</code></td> <td>Disk and controller status</td> <td>Select disk</td> </tr> <tr> <td>2</td> <td><code class="language-plaintext highlighter-rouge">0x09</code></td> <td>Get number of sector</td> <td>Disk settings</td> </tr> <tr> <td>3</td> <td><code class="language-plaintext highlighter-rouge">0x0A</code></td> <td>Read data</td> <td>Write data</td> </tr> </tbody> </table></div> <p>Now, detailed description of the ports follow. Bits are ordered in a byte as follows:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>D7 D6 D5 D4 D3 D2 D1 D0
</code></pre></div></div> <p>where <code class="language-plaintext highlighter-rouge">D7</code> is the most significant bit, and <code class="language-plaintext highlighter-rouge">D0</code> the least significant bit.</p> <h3 id="port-1-default-address-0x08"> <a href="#port-1-default-address-0x08" class="anchor-heading" aria-labelledby="port-1-default-address-0x08"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Port 1 (default address: 0x08) </h3> <p><em>WRITE</em>:</p> <p>Selects and enables one of 16 disk devices. By selecting a drive, all further operations will be performed on that drive. If the disk has not mounted any disk image, all further operations will be ignored. The previously selected device will be disabled.</p> <ul> <li><code class="language-plaintext highlighter-rouge">D7</code> : if the value is 1, disable the drive. If the value is 0, select and enable the drive.</li> <li><code class="language-plaintext highlighter-rouge">D6 D5 D4</code> : unused bits</li> <li><code class="language-plaintext highlighter-rouge">D3 D2 D1 D0</code>: index of the drive to be selected. From 0-15.</li> </ul> <p><em>READ</em>:</p> <p>Read disk status of the selected drive.</p> <ul> <li><code class="language-plaintext highlighter-rouge">D7</code> : <em>New read data available</em>. Indicates if there is at least 1 byte available for reading from Port 3 (value=0). It will be reset after data are read (value=1). If the value is 1, data read from Port 3 will be invalid or no new data is available.</li> <li><code class="language-plaintext highlighter-rouge">D6</code> : <em>Track 0</em>. Indicates if the head is positioned at track 0 (value=0).</li> <li><code class="language-plaintext highlighter-rouge">D5</code> : <em>Interrupt Enabled</em>. Indicates if interrupts are used (value=0).</li> <li><code class="language-plaintext highlighter-rouge">D4 D3</code> : Unused bits; they are always 0.</li> <li><code class="language-plaintext highlighter-rouge">D2</code> : <em>Head Status</em>. Indicates the correctness of the head setting. If the value is 0, reading sector number from Port 2 will be valid.</li> <li><code class="language-plaintext highlighter-rouge">D1</code> : <em>Move head</em>. Indicates if the movement of the disk head is allowed. If the value is 1, all track number changes will be ignored.</li> <li><code class="language-plaintext highlighter-rouge">D0</code> : <em>Enter new write data</em>. Indicates if the device is ready for writing data. If the value is 1, all written data will be ignored.</li> </ul> <p>Initial values of the bits are: <code class="language-plaintext highlighter-rouge">11100111</code>.</p> <h3 id="port-2-default-address-0x09"> <a href="#port-2-default-address-0x09" class="anchor-heading" aria-labelledby="port-2-default-address-0x09"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Port 2 (default address: 0x09) </h3> <p><em>WRITE</em>:</p> <p>Control the disk head, and other settings if a disk drive is selected.</p> <ul> <li><code class="language-plaintext highlighter-rouge">D7</code> : <em>Write Enable</em>. Initializes write sequence (enables writing to the disk; value=1). The plugin sets the sector number to 0 and also value 0 to bit <code class="language-plaintext highlighter-rouge">D0</code> of Port 1 (<em>Enter new write data</em>). According to the manual, a writing sequence holds only for short time, maximally until the end of sector is reached. The plugin does not limit the sequence period, it is deactivated only when the end of the sector is reached. In addition, each first byte and the last byte of a sector should have set its MSB (7th bit) to 1. It was called the “sync bit” for easier identification of start or end of a sector. However, the plugin does not require it.</li> <li><code class="language-plaintext highlighter-rouge">D7</code> : <em>Write Enable</em>. Initializes write sequence (enables writing to the disk; value=1). The plugin sets the sector number to 0 and also value 0 to bit <code class="language-plaintext highlighter-rouge">D0</code> of Port 1 (<em>Enter new write data</em>). According to the manual, a writing sequence holds only for short time, maximally until the end of sector is reached. The plugin does not limit the sequence period, it is deactivated only when the end of the sector is reached. In addition, each first byte and the last byte of a sector should have set its MSB (7th bit) to 1. It was called the “sync bit” for easier identification of start or end of a sector. However, the plugin does not require it.</li> <li><code class="language-plaintext highlighter-rouge">D6</code> : <em>Head Current Switch</em>. On real disks the bit should be set to 1 when a program is writing data to tracks from 43-76. The plugin the bit is ignored.</li> <li><code class="language-plaintext highlighter-rouge">D5</code> : <em>Interrupt Disable</em>. If set to 1, interrupts support will be disabled.</li> <li><code class="language-plaintext highlighter-rouge">D4</code> : <em>Interrupt Enable</em>. If set to 1, interrupts support will be enabled. Interrupt will be signalled to CPU on “sector true” event. This effectively means on every other position reading (see <em>READ</em> part below). The device will emit interrupt vector equivalent to executing an <code class="language-plaintext highlighter-rouge">RST</code> instruction. The interrupt vector number is set up globally<br /> in the plugin settings.</li> <li><code class="language-plaintext highlighter-rouge">D3</code> : <em>Head unload</em>. Removes head from the disk surface. Reading sector number will now become invalid. In addition, value of bit <code class="language-plaintext highlighter-rouge">D7</code> from Port 1 (<em>New read data available</em>) become 1 (no new data).</li> <li><code class="language-plaintext highlighter-rouge">D2</code> : <em>Head load</em>. Sets the disk head onto disk surface. Reading sector number now becomes valid. If additionally the bit <code class="language-plaintext highlighter-rouge">D7</code> from Port 1 (<em>New data available</em>) is set, it is possible to read data from the disk.</li> <li><code class="language-plaintext highlighter-rouge">D1</code> : <em>Step Out</em>. Move the disk head back by 1 track (the track number is decremented). It is required to check bit <code class="language-plaintext highlighter-rouge">D1</code> of Port 1 (<em>Move head</em>) to have value 0.</li> <li><code class="language-plaintext highlighter-rouge">D0</code> : <em>Step In</em>. Move the disk head ahead by 1 track (the track number is incremented). It is required to check bit <code class="language-plaintext highlighter-rouge">D1</code> of Port 1 (<em>Move head</em>) to have value 0.</li> </ul> <p><em>READ</em>:</p> <p>Reads the number of the sector. The value can be read only if a disk drive is selected and the disk head is positioned at the disk surface (by setting the bit <code class="language-plaintext highlighter-rouge">D2</code>).</p> <ul> <li><code class="language-plaintext highlighter-rouge">D7 D6</code> : Unused bits; they are always 1.</li> <li><code class="language-plaintext highlighter-rouge">D5 D4 D3 D2 D1</code>: Number of the sector, counted from 0.</li> <li><code class="language-plaintext highlighter-rouge">D0</code> : <em>Sector True</em>. If the value is 0, the offset in sector is 0. According to manual, the bit is set for maximum 30 microseconds. Programs could detect the bit set and quickly start writing data until the <em>Sector true</em> came back again. It could be made in time easily, because CPU was much faster than disk itself. plugin does not limit the period. The value is 0 practically all the time, until first byte is written.</li> </ul> <h3 id="port-3-default-address-0x0a"> <a href="#port-3-default-address-0x0a" class="anchor-heading" aria-labelledby="port-3-default-address-0x0a"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Port 3 (default address: 0x0A) </h3> <p><em>WRITE</em>:</p> <p>Write a byte to disk. In order to perform valid write, the <em>Write Enable</em> <code class="language-plaintext highlighter-rouge">D7</code> bit of Port 2 must be set to 1. Before data are written to disk, it is required to check bit <code class="language-plaintext highlighter-rouge">D0</code> from Port 1 (<em>Enter new write data</em>).</p> <p><em>READ</em>:</p> <p>Read a byte from disk. In order to perform valid read, the <em>Head load</em> <code class="language-plaintext highlighter-rouge">D2</code> bit of Port 2 must be set to 1. Only if bit <code class="language-plaintext highlighter-rouge">D7</code> from Port 1 (<em>New read data available</em>) is set to 0, the read data are valid.</p> <h3 id="program-example"> <a href="#program-example" class="anchor-heading" aria-labelledby="program-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Program example </h3> <p>In this section, an example is presented showing how to read/write data from/to the floppy disk. At first, it writes one byte (letter <code class="language-plaintext highlighter-rouge">A</code> with ASCII value 65) to track 1, sector 18 and offset 20. Then, it reads the byte to operating memory at address 0x200.</p> <p>The program uses 3 procedures (in assembler for Intel 8080) for setting the disk position (<code class="language-plaintext highlighter-rouge">ltrack</code> for loading the track number, <code class="language-plaintext highlighter-rouge">lsector</code> for loading the sector number, and <code class="language-plaintext highlighter-rouge">loffset</code> for loading the offset within the sector) and two more for data reading (<code class="language-plaintext highlighter-rouge">read</code>) and writing (<code class="language-plaintext highlighter-rouge">write</code>).</p> <div class="language-plaintext code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code>disk0  equ 0    ; disk number
track  equ 1    ; track number
sector equ 18   ; sector number
offset equ 20   ; offset within the sector
data   equ 'A'  ; data for writing

dcx sp          ; set stack register to 0xFFFF

mvi a, disk0    ; select disk
out 08h

call ltrack     ; set track number

call we         ; set 'write enable' sequence
call lsector    ; set sector number
call loffset    ; set sector offset
call write      ; write data

call lsector    ; set sector number (for clearing the offset)
call loffset    ; set sector offset
call read       ; read data

lxi h, readdata ; load address for reading the data
mov m, a        ; move the data there

hlt             ; end

ltrack0:        ; the procedure will set track number to 0
in 08h          ; read disk status
ani 1000000b    ; track 0 ?
rz              ; yes, return
mvi a, 1000b    ; head unload
out 09h
call movetrk    ; wait until the disk head can be moved
mvi a, 10b      ; step out, decrement track number
out 08h
jmp ltrack0

ltrack:         ; procedure sets a track number
call ltrack0    ; at first, set track number to 0
mvi b, track+1  ; b = track + 1
stepin:         ; stepin: {
dcr b           ;   b--;
rz              ;   if (b == 0) return;
call movetrk    ;   wait until the disk head can be moved
mvi a, 1        ;   step in, increment track number
out 09h
jmp stepin      ;   goto stepin;
                ; }

movetrk:        ; procedure waits until the disk head can be moved
in 08h          ; read disk status
ani 10b         ; can the disk head be moved?
jnz movetrk     ; nope, try again...
ret             ; yes, return

lsector:        ; procedure sets a sector number
mvi a, 100b     ; head load
out 09h
waits:
in 09h          ; read sector number
ani 3Fh         ; clear unused bits
rrc
cpi sector      ; is the number what is requested?
jnz waits       ; nope, try again
ret             ; yes, return

loffset:        ; procedure sets a sector offset
mvi b, offset+1 ; b = offset + 1
stepoff:        ; stepoff: {
dcr b           ;   b--;
rz              ;   if (b == 0) return;
call read       ;   read data; the offset is incremented
jmp stepoff     ;   goto stepoff;
                ; }

read:           ; procedure reads data from the disk
in 08h          ; read disk status
ani 100b        ; check if the disk head is loaded on the disk surface
rnz             ; if not, return
waitr:
in 08h          ; read disk status
ani 10000000b   ; New read data available ?
jnz waitr       ; nope, try again...
in 0Ah          ; yes, read data
ret             ; return

we:             ; procedure enables 'write enable' sequence
mvi a, 10000000b ; write enable
out 09h
ret

write:          ; procedure writes data to the disk
in 08h          ; read disk status
ani 100b        ; check if the disk head is loaded on the disk surface
rnz             ; if not, return
waitw:
in 08h          ; read disk status
ani 1           ; enter new write data ?
jnz waitw       ; nope, try again...
mvi a, data     ; yes, write data
out 0Ah
ret

org 200h
readdata: db 0
</code></pre></div></div> <h2 id="experimental-cpm-support"> <a href="#experimental-cpm-support" class="anchor-heading" aria-labelledby="experimental-cpm-support"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Experimental CP/M support </h2> <p>88-dcdd plugin adds <strong>highly experimental</strong> support of handling files on a CP/M filesystem. It is now possible to create disk images, and read/write files from/to a disk image using CP/M filesystem.</p> <p>The CP/M tool can be accessed from command-line:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; bin/88-dcdd --help

Usage: 88-dcdd [-hV] [-F=FILE] (-l | (-f=FORMAT -i=FILE)) [COMMAND]
88-DCDD Altair floppy disk drive
  -f, --format=FORMAT      disk format ID
  -F, --format-file=FILE   disk format file (TOML)
  -h, --help               Show this help message and exit.
  -i, --image=FILE         disk image file
  -l, --list-formats       lists available disk format IDs
  -V, --version            Print version information and exit.
Commands:
  cpmfs, cpm  CP/M filesystem commands
</code></pre></div></div> <p>In order to be able to work with a disk image, the tool needs to know disk image format. The disk format is selected using <code class="language-plaintext highlighter-rouge">-f</code> argument, followed by format ID.</p> <h3 id="example-files-readingwriting"> <a href="#example-files-readingwriting" class="anchor-heading" aria-labelledby="example-files-readingwriting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example files reading/writing </h3> <p>In order to work with a disk image the image file and disk format must be selected, followed by a CP/M command:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; bin/88-dcdd -i altcpm.dsk -f cpm2-simh cpm

Missing required subcommand
Usage: 88-dcdd cpmfs [-hV] [COMMAND]
CP/M filesystem commands
  -h, --help      Show this help message and exit.
  -V, --version   Print version information and exit.
Commands:
  cat         Show file content
  copy, cp    Copy files
  dates       Show files dates
  format      Format CP/M disk image
  info        Volume information
  list, ls    List files
  remove, rm  Remove file
</code></pre></div></div> <p>Now you can see all the options of the CP/M tool. Let’s list all the files in the disk image:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; bin/88-dcdd -i altcpm.dsk -f cpm2-simh cpm ls

St |File name    |Flags   |Ex |S2 |Rc |Bc |Al
---------------------------------------------
00 |    STAT.COM |        |00 |00 |2a |00 |08 09 0A 0B 0C 0D 00 00 00 00 00 00 00 00 00 00
00 |     PIP.COM |        |00 |00 |3a |00 |0E 0F 10 11 12 13 14 15 00 00 00 00 00 00 00 00
00 |      ED.COM |        |00 |00 |34 |00 |16 17 18 19 1A 1B 1C 00 00 00 00 00 00 00 00 00
00 |     DDT.COM |        |00 |00 |26 |00 |1D 1E 1F 20 21 00 00 00 00 00 00 00 00 00 00 00
00 |     ASM.COM |        |00 |00 |40 |00 |22 23 24 25 26 27 28 29 00 00 00 00 00 00 00 00
00 |    LOAD.COM |        |00 |00 |0e |00 |2A 2B 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 |  SUBMIT.COM |        |00 |00 |10 |00 |2C 2D 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 |    XSUB.COM |        |00 |00 |06 |00 |2E 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 |  MOVCPM.COM |        |00 |00 |60 |00 |2F 30 31 32 33 34 35 36 37 38 39 3A 00 00 00 00
00 |    COPY.COM |        |00 |00 |06 |00 |3B 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 |  FORMAT.COM |        |00 |00 |0e |00 |3C 3D 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 |    DUMP.COM |        |00 |00 |03 |00 |3E 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 |  SYSGEN.SUB |        |00 |00 |02 |00 |3F 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 |    DUMP.ASM |        |00 |00 |26 |00 |45 46 47 48 49 00 00 00 00 00 00 00 00 00 00 00
00 |     PTD.HEX |        |00 |00 |06 |00 |4A 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 | ABOOT62.HEX |        |00 |00 |01 |00 |4B 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 |   CBIOS.HEX |        |00 |00 |16 |00 |4C 4D 4E 00 00 00 00 00 00 00 00 00 00 00 00 00
00 |   CBIOS.ASM |        |00 |00 |3d |00 |61 62 63 6D 6E 72 73 74 00 00 00 00 00 00 00 00
00 |     PTD.ASM |        |00 |00 |0e |00 |5F 60 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 |      LS.COM |        |00 |00 |18 |00 |40 41 42 00 00 00 00 00 00 00 00 00 00 00 00 00
00 |   CPM62.COM |        |00 |00 |48 |00 |64 65 66 67 68 69 6A 6B 6C 00 00 00 00 00 00 00
00 |  SURVEY.COM |        |00 |00 |0a |00 |50 51 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 | ABOOT62.ASM |        |00 |00 |04 |00 |86 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
</code></pre></div></div> <p>In order to copy a file to host filesystem, it is possible to use <code class="language-plaintext highlighter-rouge">copy</code> subcommand, but for outputting it on screen let’s use <code class="language-plaintext highlighter-rouge">cat</code>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; bin/88-dcdd -i altcpm.dsk -f cpm2-simh cpm cat CBIOS.ASM

; ALTAIR 8800 BIOS WITH 8800 DISK DRIVES - 256 FILES EACH
;
MSIZE   EQU     62              ;MEMORY SIZE
BIAS    EQU     (MSIZE-20)*1024
CCP     EQU     3400H+BIAS      ;START OF CCP
BDOS    EQU     CCP+806H
BIOS    EQU     CCP+1600H

        ORG     BIOS

NSECTS  EQU     ($-CCP)/128     ;# SECTORS TO BOOT
LADDR   EQU     CCP+(51*128)
PART2   EQU     CCP+(27*128)
IOBYTE  EQU     3
CDISK   EQU     4
...
</code></pre></div></div> <p>In order to write a file to a disk image, let’s prepare one, name it <code class="language-plaintext highlighter-rouge">test</code> on a host filesystem:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Testing, testing!

</code></pre></div></div> <p>In order to copy the file on the disk image, let’s use the already mentioned <code class="language-plaintext highlighter-rouge">copy</code> command:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; bin/88-dcdd -i altcpm.dsk -f cpm2-simh cpm cp --help

Copy files
Usage: 88-dcdd cpmfs copy [-hV] SRC_FILE DST_FILE
Copy a file between CP/M disk image and host
      SRC_FILE    source file (cpm:// prefix if in CP/M disk image)
      DST_FILE    destination file (cpm:// prefix if in CP/M disk image
  -h, --help      Show this help message and exit.
  -V, --version   Print version information and exit.
</code></pre></div></div> <p>So we know the destination is the disk image, thus the copy command would be:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; bin/88-dcdd -i altcpm.dsk -f cpm2-simh cpm cp test cpm://test
</code></pre></div></div> <p>And now “test” it:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; bin/88-dcdd -i altcpm.dsk -f cpm2-simh cpm cat test
Testing, testing!

</code></pre></div></div> <h3 id="disk-formats"> <a href="#disk-formats" class="anchor-heading" aria-labelledby="disk-formats"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Disk formats </h3> <p>Various disk file formats are stored in a file, by default located in <code class="language-plaintext highlighter-rouge">examples/altair8800/cpm-formats.toml</code> (possible to change location with <code class="language-plaintext highlighter-rouge">-F</code> argument). Example disk format for CP/M 2.2 and standard Altair 8” diskette:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Altair 8" floppy disks for SIMH CP/M 2.2
#
# altcpm.dsk    http://cpmarchives.classiccmp.org/cpm/mirrors/www.schorn.ch/cpm/zip/altsw.zip
[[format]]
id = 'cpm2-simh'
sectorSize = 137
sectorSkew = 17
sectorOps = 'altair-floppy-mits'
bcInterpretsAsUnused = false
dateFormat = 'NOT_USED'

[format.dpb]
driveSpt = 32
spt = 32
bsh = 3
# or blm = 7
dsm = 254
drm = 255
al0 = 0xFF
al1 = 0
ofs = 6
</code></pre></div></div> <p>The diskette format contains two sections: <code class="language-plaintext highlighter-rouge">[[format]]</code>, which is the main (root) section, and <code class="language-plaintext highlighter-rouge">[format.dpb]</code> which is a subsection with disk-parameters-block (DPB).</p> <p>The main section supports the following parameters:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Name</th> <th>Default value</th> <th>Valid values</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">id</code></td> <td> </td> <td>any string without spaces</td> <td>Disk format ID</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">sectorSize</code></td> <td> </td> <td>&gt; 0</td> <td>Raw sector size in bytes</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">sectorSkew</code></td> <td>1</td> <td>optional; &gt; 0</td> <td>Sector skew in bytes. It is not required to provide, if a sector skew table is provided. Used if <code class="language-plaintext highlighter-rouge">sectorSkewTable</code> is not provided.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">sectorSkewTable</code></td> <td> </td> <td>optional; array of sectors-per-track items (see <code class="language-plaintext highlighter-rouge">driveSpt</code> below)</td> <td>Sector skew table. Used if <code class="language-plaintext highlighter-rouge">sectorSkew</code> is not provided.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">sectorOps</code></td> <td><code class="language-plaintext highlighter-rouge">dummy</code></td> <td><code class="language-plaintext highlighter-rouge">altair-floppy-mits</code>, <code class="language-plaintext highlighter-rouge">altair-floppy-deramp</code>, <code class="language-plaintext highlighter-rouge">altair-minidisk-deramp</code>, <code class="language-plaintext highlighter-rouge">dummy</code></td> <td>Sector operations - how to extract data from raw sector when reading, or how to encode data to raw sector when writing. See below for more information.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">bcInterpretsAsUnused</code></td> <td>false</td> <td>true/false</td> <td><code class="language-plaintext highlighter-rouge">BC</code> is a value in a CP/M file record saying number of used bytes in the last data record for the file (<code class="language-plaintext highlighter-rouge">false</code>) or number of unused bytes in the record (<code class="language-plaintext highlighter-rouge">true</code>).</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">dateFormat</code></td> <td><code class="language-plaintext highlighter-rouge">NOT_USED</code></td> <td><code class="language-plaintext highlighter-rouge">NOT_USED</code>, <code class="language-plaintext highlighter-rouge">NATIVE</code>, <code class="language-plaintext highlighter-rouge">NATIVE2</code>, <code class="language-plaintext highlighter-rouge">DATE_STAMPER</code></td> <td>What type of date format this CP/M filesystem uses. See a description below.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">sectorsPerTrack0</code> … <code class="language-plaintext highlighter-rouge">sectorsPerTrack15</code></td> <td>32</td> <td>&gt; 0</td> <td>Count of sectors in a disk image, on disk A (0) up to P (15)</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">sectorSize0</code> … <code class="language-plaintext highlighter-rouge">sectorSize15</code></td> <td>137</td> <td>&gt; 0</td> <td>Size of one sector in bytes on disk A (0) up to P (15)</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">image0</code> … <code class="language-plaintext highlighter-rouge">image15</code></td> <td>N/A</td> <td>Path to existing file</td> <td>File name to mount on disk A (0) up to P (15)</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">imageMounted0</code> … <code class="language-plaintext highlighter-rouge">imageMounted15</code></td> <td>false</td> <td>true/false</td> <td>Whether disk image is mounted on start</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">interruptVector</code></td> <td>7</td> <td>0 to 7</td> <td>Interrupt vector to be used when an interrupt is signalled to CPU</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">interruptsSupported</code></td> <td>true</td> <td>true/false</td> <td>Whether interrupts are supported (independent on Port 2 runtime settings)</td> </tr> </tbody> </table></div> <h3 id="sector-operations-sectorops"> <a href="#sector-operations-sectorops" class="anchor-heading" aria-labelledby="sector-operations-sectorops"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sector operations (<code class="language-plaintext highlighter-rouge">sectorOps</code>) </h3> <p>In CP/M, data records are usually prefixed and/or appended with additional data like checksum in order to obtain full sector. A CP/M data record has 128 bytes (this is fixed for all CP/M versions). But standard Altair 8” diskette had capacity of 137 bytes, thus still having available space of 9 bytes.</p> <p>On reading, these data/checksums were usually checked before the data is extracted. Various CP/M versions used different sector operations - meaning data records might be placed on various different positions (different offsets) in the raw sector.</p> <p>This section will describe sector operations supported in 88-dcdd CP/M tool. There are more possibilities of sector arrangement, but currently only the following are supported.</p> <p><strong>Dummy</strong></p> <p>Value: <code class="language-plaintext highlighter-rouge">dummy</code></p> <p>Record is not manipulated at all. Sector size is respected, so the 128-byte record is placed in the beginning of the sector, padding the rest of available sector space with 0.</p> <p><strong>Altair Floppy: MITS</strong></p> <p>Value: <code class="language-plaintext highlighter-rouge">altair-floppy-mits</code></p> <p>This sector ops are used in <a href="https://schorn.ch/altair_3.php" target="_blank">simh</a> Altair8800 disk images, assuming standard 8” Altair diskette. Here the sector size is hardcoded to 137 bytes, regardless of what is in the settings. The sector is arranged as follows:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Byte</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>Track number + 0x80</td> </tr> <tr> <td>1</td> <td>Skewed sector = <code class="language-plaintext highlighter-rouge">(Sector number * 17) MOD 32</code> (the <code class="language-plaintext highlighter-rouge">sectorSkew</code> from the settings is overriden to 17, <code class="language-plaintext highlighter-rouge">driveSpt</code> overriden to 32)</td> </tr> <tr> <td>2</td> <td>0</td> </tr> <tr> <td>3 - 131</td> <td>Data</td> </tr> <tr> <td>132</td> <td>0xFF (“stop byte”)</td> </tr> <tr> <td>133</td> <td>Data checksum (sum of bytes 3-131)</td> </tr> <tr> <td>134</td> <td>0</td> </tr> <tr> <td>135</td> <td>0</td> </tr> <tr> <td>136</td> <td>0</td> </tr> </tbody> </table></div> <p><strong>Altair Floppy: DeRamp</strong></p> <p>Value: <code class="language-plaintext highlighter-rouge">altair-floppy-deramp</code></p> <p>This sector ops is described in DeRamp CP/M BIOS, assuming standard 8” Altair diskette. The sector size is hardcoded to 137 bytes, regardless of what is in the settings.</p> <p>The sector arrangement is different based on a track number. For tracks 0-5, the arrangement is:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Byte</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>0</td> </tr> <tr> <td>1</td> <td>1</td> </tr> <tr> <td>2 - 130</td> <td>Data</td> </tr> <tr> <td>131</td> <td>0xFF (“stop byte”)</td> </tr> <tr> <td>132</td> <td>Data checksum (sum of bytes 2-130)</td> </tr> <tr> <td>133</td> <td>0</td> </tr> <tr> <td>134</td> <td>0</td> </tr> <tr> <td>135</td> <td>0</td> </tr> <tr> <td>136</td> <td>0</td> </tr> </tbody> </table></div> <p>For tracks 5-76, the arrangement is:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Byte</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>Sector number (not skewed)</td> </tr> <tr> <td>1</td> <td>0</td> </tr> <tr> <td>2</td> <td>0</td> </tr> <tr> <td>3</td> <td>0</td> </tr> <tr> <td>4</td> <td>0</td> </tr> <tr> <td>5</td> <td>0</td> </tr> <tr> <td>6 - 134</td> <td>Data</td> </tr> <tr> <td>135</td> <td>0xFF (“stop byte”)</td> </tr> <tr> <td>136</td> <td>data checksum (sum of bytes 6-134)</td> </tr> </tbody> </table></div> <p><strong>Altair Minidisk: DeRamp</strong></p> <p>Value: <code class="language-plaintext highlighter-rouge">altair-minidisk-deramp</code></p> <p>This sector ops is described in DeRamp CP/M BIOS, assuming 5.25” Altair Minidisk. The sector size is hardcoded to 137 bytes, regardless of what is in the settings.</p> <p>The sector arrangement is different based on a track number. For tracks 0-3, the arrangement is:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Byte</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>0</td> </tr> <tr> <td>1</td> <td>1</td> </tr> <tr> <td>2 - 130</td> <td>Data</td> </tr> <tr> <td>131</td> <td>0xFF (“stop byte”)</td> </tr> <tr> <td>132</td> <td>Data checksum (sum of bytes 2-130)</td> </tr> <tr> <td>133</td> <td>0</td> </tr> <tr> <td>134</td> <td>0</td> </tr> <tr> <td>135</td> <td>0</td> </tr> <tr> <td>136</td> <td>0</td> </tr> </tbody> </table></div> <p>For tracks 4-34, the arrangement is:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Byte</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>Sector number (not skewed)</td> </tr> <tr> <td>1</td> <td>0</td> </tr> <tr> <td>2</td> <td>0</td> </tr> <tr> <td>3</td> <td>0</td> </tr> <tr> <td>4</td> <td>0</td> </tr> <tr> <td>5</td> <td>0</td> </tr> <tr> <td>6 - 134</td> <td>Data</td> </tr> <tr> <td>135</td> <td>0xFF (“stop byte”)</td> </tr> <tr> <td>136</td> <td>data checksum (sum of bytes 6-134)</td> </tr> </tbody> </table></div> <h3 id="date-formats-dateformat"> <a href="#date-formats-dateformat" class="anchor-heading" aria-labelledby="date-formats-dateformat"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Date formats (<code class="language-plaintext highlighter-rouge">dateFormat</code>) </h3> <p>Date formats are partially described in various manuals: <a href="https://linux.die.net/man/5/cpm" target="_blank">CP/M tools manual</a>, <a href="https://www.seasip.info/Cpm/dosses.html" target="_blank">BDOS replacements for CP/M 2 and 3</a>, <a href="https://www.seasip.info/Cpm/format22.html" target="_blank">CP/M 2.2 file format</a>, <a href="https://www.seasip.info/Cpm/format31.html" target="_blank">CP/M 3.1 file format</a> and <a href="https://www.seasip.info/Cpm/format41.html" target="_blank">CP/M 4.1 file format</a>.</p> <p><strong>Naive 1</strong></p> <p>Value: <code class="language-plaintext highlighter-rouge">NATIVE</code></p> <p>Used in CP/M 2.2 in various BDOS replacements: Z80DOS, DOS+, P2DOS and CP/M Plus. Every 4th entry of a directory is considered to be a datestamp record. The structure of the record is as follows:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>21 00 C1 C1 M1 M1 M1 M1 A1 A1 A1 A1 C2 C2 M2 M2
M2 M2 A2 A2 A2 A2 C3 C3 M3 M3 M3 M3 A3 A3 A3 A3
</code></pre></div></div> <ul> <li><code class="language-plaintext highlighter-rouge">C1</code> = File 1 Create date</li> <li><code class="language-plaintext highlighter-rouge">M1</code> = File 1 Modify date/time</li> <li><code class="language-plaintext highlighter-rouge">A1</code> = File 1 Access date/time</li> <li><code class="language-plaintext highlighter-rouge">C2</code> = File 2 Create date</li> <li><code class="language-plaintext highlighter-rouge">M2</code> = File 2 Modify date/time</li> <li><code class="language-plaintext highlighter-rouge">A2</code> = File 2 Access date/time</li> <li><code class="language-plaintext highlighter-rouge">C3</code> = File 3 Create date</li> <li><code class="language-plaintext highlighter-rouge">M3</code> = File 3 Modify date/time</li> <li><code class="language-plaintext highlighter-rouge">A3</code> = File 3 Access date/time</li> </ul> <p><strong>Native 2</strong></p> <p>Value: <code class="language-plaintext highlighter-rouge">NATIVE2</code></p> <p>This file format is described only on single place (<a href="https://manpages.debian.org/testing/cpmtools/cpm.5.en.html" target="_blank">here</a>) and Im not sure if it really existed. If yes, it’s possible to use it. The source claims the format was used in P2DOS or CP/M Plus BDOSes. Every 4th entry of a directory is considered to be a datestamp record. The structure is as follows:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>21 C1 C1 C1 C1 M1 M1 M1 M1 00 00 C2 C2 C2 C2 M2
M2 M2 M2 00 00 C3 C3 C3 C3 M3 M3 M3 M3 00 00 00
</code></pre></div></div> <ul> <li><code class="language-plaintext highlighter-rouge">C1</code> = File 1 Create date</li> <li><code class="language-plaintext highlighter-rouge">M1</code> = File 1 Modify date/time</li> <li><code class="language-plaintext highlighter-rouge">C2</code> = File 2 Create date</li> <li><code class="language-plaintext highlighter-rouge">M2</code> = File 2 Modify date/time</li> <li><code class="language-plaintext highlighter-rouge">C3</code> = File 3 Create date</li> <li><code class="language-plaintext highlighter-rouge">M3</code> = File 3 Modify date/time</li> </ul> <p>The source further says: CP/M Plus further allows optionally to record the access instead of creation date as first time stamp.</p> <ul> <li>2 bytes (little-endian) days starting with 1 at 01-01-1978</li> <li>1 byte hour in BCD format</li> <li>1 byte minute in BCD format</li> </ul> <p>This is however not supported in this date format.</p> <p><strong>Date stamper</strong></p> <p>Value: <code class="language-plaintext highlighter-rouge">DATE_STAMPER</code></p> <p>File date/times are saved in a special file called <code class="language-plaintext highlighter-rouge">!!!TIME&amp;.DAT</code> in the CP/M filesystem. The file during CP/M runtime is managed by the special software called DateStamper, which must be installed to BDOS manually ( described <a href="https://manpages.debian.org/testing/cpmtools/cpm.5.en.html" target="_blank">here</a>, <a href="https://deramp.com/downloads/digital_research/Manuals/CPM%20File%20System.pdf" target="_blank">here</a> and <a href="https://661.org/p112/files/zsdos.pdf" target="_blank">here</a>).</p> <p>88-dcdd CP/M tool does not support this type of date formats for now. Since the file <code class="language-plaintext highlighter-rouge">!!!TIME&amp;.DAT</code> has special requirements (it must be allocated as the first record in directory entry), the setting <code class="language-plaintext highlighter-rouge">DATE_STAMPER</code> only makes sure the first directory is ignored during entry allocation when writing files to disk image.</p> <h2 id="configuration-file"> <a href="#configuration-file" class="anchor-heading" aria-labelledby="configuration-file"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuration file </h2> <p>The following table shows all the possible file configurations of the plugin:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Name</th> <th>Default value</th> <th>Valid values</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">port1CPU</code></td> <td>0x08</td> <td>&gt; 0 and &lt; 256</td> <td>Number of Port 1</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">port2CPU</code></td> <td>0x09</td> <td>&gt; 0 and &lt; 256</td> <td>Number of Port 2</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">port3CPU</code></td> <td>0x0A</td> <td>&gt; 0 and &lt; 256</td> <td>Number of Port 3</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">sectorsPerTrack0</code> … <code class="language-plaintext highlighter-rouge">sectorsPerTrack15</code></td> <td>32</td> <td>&gt; 0</td> <td>Count of sectors in a disk image, on disk A (0) up to P (15)</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">sectorSize0</code> … <code class="language-plaintext highlighter-rouge">sectorSize15</code></td> <td>137</td> <td>&gt; 0</td> <td>Size of one sector in bytes on disk A (0) up to P (15)</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">image0</code> … <code class="language-plaintext highlighter-rouge">image15</code></td> <td>N/A</td> <td>Path to existing file</td> <td>File name to mount on disk A (0) up to P (15)</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">imageMounted0</code> … <code class="language-plaintext highlighter-rouge">imageMounted15</code></td> <td>false</td> <td>true/false</td> <td>Whether disk image is mounted on start</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">interruptVector</code></td> <td>7</td> <td>0 to 7</td> <td>Interrupt vector to be used when an interrupt is signalled to CPU</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">interruptsSupported</code></td> <td>true</td> <td>true/false</td> <td>Whether interrupts are supported (independent on Port 2 runtime settings)</td> </tr> </tbody> </table></div> </div> </div> <div class="search-overlay"></div> </div> <script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script> </body> </html>
