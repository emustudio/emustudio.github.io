<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Run states - Developer documentation for emuStudio</title> <link rel="shortcut icon" href="/documentation/developer/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/documentation/developer/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3492956-5"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-3492956-5', { 'anonymize_ip': true }); </script> <script type="text/javascript" src="/documentation/developer/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/documentation/developer/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Run states | Developer documentation for emuStudio</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="Run states" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Developer documentation for emuStudio. emuStudio is universal emulation platform and framework targeting mainly academic sphere." /> <meta property="og:description" content="Developer documentation for emuStudio. emuStudio is universal emulation platform and framework targeting mainly academic sphere." /> <link rel="canonical" href="/documentation/developer/cpu/runstate" /> <meta property="og:url" content="/documentation/developer/cpu/runstate" /> <meta property="og:site_name" content="Developer documentation for emuStudio" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Run states" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Developer documentation for emuStudio. emuStudio is universal emulation platform and framework targeting mainly academic sphere.","headline":"Run states","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/documentation/developer/assets/logo-1.svg"}},"url":"/documentation/developer/cpu/runstate"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/documentation/developer/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/documentation/developer/introduction/" class="nav-list-link">Introduction</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/documentation/developer/getting_started/" class="nav-list-link">Getting started</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/developer/getting_started/contributing" class="nav-list-link">How to contribute</a></li><li class="nav-list-item "><a href="/documentation/developer/getting_started/gitflow" class="nav-list-link">Git workflow</a></li><li class="nav-list-item "><a href="/documentation/developer/getting_started/documenting" class="nav-list-link">Documenting</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/documentation/developer/plugin_basics/" class="nav-list-link">Plugin basics</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/developer/plugin_basics/loading" class="nav-list-link">Loading and initialization</a></li><li class="nav-list-item "><a href="/documentation/developer/plugin_basics/context" class="nav-list-link">Plugin contexts</a></li></ul></li><li class="nav-list-item"><a href="/documentation/developer/compiler/" class="nav-list-link">Writing a compiler</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/documentation/developer/cpu/" class="nav-list-link">Writing a CPU</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/developer/cpu/rootclass" class="nav-list-link">Plugin Root</a></li><li class="nav-list-item active"><a href="/documentation/developer/cpu/runstate" class="nav-list-link active">Run states</a></li><li class="nav-list-item "><a href="/documentation/developer/cpu/engine" class="nav-list-link">Emulator engine</a></li><li class="nav-list-item "><a href="/documentation/developer/cpu/disassembler" class="nav-list-link">Disassembler</a></li></ul></li><li class="nav-list-item"><a href="/documentation/developer/memory/" class="nav-list-link">Writing a memory</a></li><li class="nav-list-item"><a href="/documentation/developer/device/" class="nav-list-link">Writing a device</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Developer documentation for emuStudio" aria-label="Search Developer documentation for emuStudio" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="/" class="site-button" > Back to website </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/documentation/developer/cpu/">Writing a CPU</a></li> <li class="breadcrumb-nav-list-item"><span>Run states</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <script type="text/javascript"> gtag('event', 'developerdoc', { 'event_category': 'developer', 'event_label': 'Run states' }); </script> <h1 id="run-states"> <a href="#run-states" class="anchor-heading" aria-labelledby="run-states"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Run states </h1> <p>Emulator “life” is a state machine. A state machine reacts on asynchronous events, which make the machine to transition the current state to another state. In emuStudio, whole emulation “state” depends on CPU run state. The run state is a name for the following states: <code class="language-plaintext highlighter-rouge">breakpoint</code> (starting state), <code class="language-plaintext highlighter-rouge">running</code>, <code class="language-plaintext highlighter-rouge">stopped</code> (more variants).</p> <p>The state machine, how it should work, can be seen in the following diagram:</p> <p><img src="/documentation/developer/assets/runstate.svg" alt="runstate" /></p> <p>The states of the state machine are encoded into an enum <a href="/documentation/developer/emulib_javadoc/net/emustudio/emulib/plugins/cpu/CPU.RunState.html" target="_blank">CPU.RunState</a> in emuLib:</p> <div class="language-java code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">enum</span> <span class="nc">RunState</span> <span class="o">{</span>
    <span class="no">STATE_STOPPED_NORMAL</span><span class="o">(</span><span class="s">"stopped"</span><span class="o">),</span>
    <span class="no">STATE_STOPPED_BREAK</span><span class="o">(</span><span class="s">"breakpoint"</span><span class="o">),</span>
    <span class="no">STATE_STOPPED_ADDR_FALLOUT</span><span class="o">(</span><span class="s">"stopped (address fallout)"</span><span class="o">),</span>
    <span class="no">STATE_STOPPED_BAD_INSTR</span><span class="o">(</span><span class="s">"stopped (instruction fallout)"</span><span class="o">),</span>
    <span class="no">STATE_RUNNING</span><span class="o">(</span><span class="s">"running"</span><span class="o">);</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div> <p>Implementation of the state machine is a sole responsibility of CPU plugin. emuStudio has some expectations of it, like:</p> <ul> <li>initial run state should be <code class="language-plaintext highlighter-rouge">STATE_STOPPED_BREAK</code></li> <li>calling <code class="language-plaintext highlighter-rouge">reset()</code> should set the run state to <code class="language-plaintext highlighter-rouge">STATE_STOPPED_BREAK</code></li> <li>calling <code class="language-plaintext highlighter-rouge">pause()</code> if the current state is not one of <code class="language-plaintext highlighter-rouge">STATE_STOPPED_(how)</code> variant, it should set the run state to <code class="language-plaintext highlighter-rouge">STATE_STOPPED_BREAK</code>. Otherwise, do nothing.</li> <li>calling <code class="language-plaintext highlighter-rouge">step()</code> if the current state is one of <code class="language-plaintext highlighter-rouge">STATE_STOPPED_(how)</code> (except <code class="language-plaintext highlighter-rouge">STATE_STOPPED_BREAK</code>), it should do nothing. Otherwise, it should set the run state to: <ul> <li><code class="language-plaintext highlighter-rouge">STATE_STOPPED_BREAK</code>, if the execution of the current instruction did not cause error, or it wasn’t a “halt” instruction.</li> <li><code class="language-plaintext highlighter-rouge">STATE_STOPPED_(how)</code> state, where <code class="language-plaintext highlighter-rouge">(how)</code> should be replaced by: <ul> <li><code class="language-plaintext highlighter-rouge">BAD_INSTR</code> - if unknown instruction was encountered</li> <li><code class="language-plaintext highlighter-rouge">ADDR_FALLOUT</code> - if instruction pointed to unknown or forbidden memory location</li> <li><code class="language-plaintext highlighter-rouge">NORMAL</code> - if the instruction was “halt” causing CPU to “halt”</li> </ul> </li> </ul> </li> <li>calling <code class="language-plaintext highlighter-rouge">run()</code> should set the state to <code class="language-plaintext highlighter-rouge">STATE_RUNNING</code> and run instructions “infinitely”, upon external event or some error, in which case it should set the state to: <ul> <li><code class="language-plaintext highlighter-rouge">STATE_STOPPED_BREAK</code> - if external call <code class="language-plaintext highlighter-rouge">pause()</code> method</li> <li><code class="language-plaintext highlighter-rouge">STATE_STOPPED_(how)</code> state, where <code class="language-plaintext highlighter-rouge">(how)</code> should be replaced by: <ul> <li><code class="language-plaintext highlighter-rouge">BAD_INSTR</code> - if unknown instruction was encountered</li> <li><code class="language-plaintext highlighter-rouge">ADDR_FALLOUT</code> - if instruction pointed to unknown or forbidden memory location</li> <li><code class="language-plaintext highlighter-rouge">NORMAL</code> - if the instruction was “halt” causing CPU to “halt”</li> </ul> </li> </ul> </li> <li>calling <code class="language-plaintext highlighter-rouge">stop()</code> if the current state is one of <code class="language-plaintext highlighter-rouge">STATE_STOPPED_(how)</code> (except <code class="language-plaintext highlighter-rouge">STATE_STOPPED_BREAK</code>), it should do nothing. Otherwise it should set the state to <code class="language-plaintext highlighter-rouge">STATE_STOPPED_NORMAL</code>.</li> </ul> <p>If the CPU plugin root class implements <a href="/documentation/developer/emulib_javadoc/net/emustudio/emulib/plugins/cpu/CPU.html" target="_blank">CPU</a> interface, it is its responsibility to notify CPU run state changes and manage run state “listeners”. But if the plugin root class extends <a href="/documentation/developer/emulib_javadoc/net/emustudio/emulib/plugins/cpu/AbstractCPU.html" target="_blank">AbstractCPU</a>, it does not have care about listeners and run state notifications, because the class implements it.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
