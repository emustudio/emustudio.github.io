<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Writing a compiler - Developer documentation for emuStudio</title> <link rel="shortcut icon" href="/documentation/developer/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/documentation/developer/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3492956-5"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-3492956-5', { 'anonymize_ip': true }); </script> <script type="text/javascript" src="/documentation/developer/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/documentation/developer/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Writing a compiler | Developer documentation for emuStudio</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="Writing a compiler" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Developer documentation for emuStudio. emuStudio is universal emulation platform and framework targeting mainly academic sphere." /> <meta property="og:description" content="Developer documentation for emuStudio. emuStudio is universal emulation platform and framework targeting mainly academic sphere." /> <link rel="canonical" href="/documentation/developer/compiler/" /> <meta property="og:url" content="/documentation/developer/compiler/" /> <meta property="og:site_name" content="Developer documentation for emuStudio" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Writing a compiler" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Developer documentation for emuStudio. emuStudio is universal emulation platform and framework targeting mainly academic sphere.","headline":"Writing a compiler","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/documentation/developer/assets/logo-1.svg"}},"url":"/documentation/developer/compiler/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/documentation/developer/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/documentation/developer/introduction/" class="nav-list-link">Introduction</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/documentation/developer/getting_started/" class="nav-list-link">Getting started</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/developer/getting_started/contributing" class="nav-list-link">How to contribute</a></li><li class="nav-list-item "><a href="/documentation/developer/getting_started/gitflow" class="nav-list-link">Git workflow</a></li><li class="nav-list-item "><a href="/documentation/developer/getting_started/documenting" class="nav-list-link">Documenting</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/documentation/developer/plugin_basics/" class="nav-list-link">Plugin basics</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/developer/plugin_basics/loading" class="nav-list-link">Loading and initialization</a></li><li class="nav-list-item "><a href="/documentation/developer/plugin_basics/context" class="nav-list-link">Plugin contexts</a></li></ul></li><li class="nav-list-item active"><a href="/documentation/developer/compiler/" class="nav-list-link active">Writing a compiler</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/documentation/developer/cpu/" class="nav-list-link">Writing a CPU</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/developer/cpu/rootclass" class="nav-list-link">Plugin Root</a></li><li class="nav-list-item "><a href="/documentation/developer/cpu/runstate" class="nav-list-link">Run states</a></li><li class="nav-list-item "><a href="/documentation/developer/cpu/engine" class="nav-list-link">Emulator engine</a></li><li class="nav-list-item "><a href="/documentation/developer/cpu/disassembler" class="nav-list-link">Disassembler</a></li></ul></li><li class="nav-list-item"><a href="/documentation/developer/memory/" class="nav-list-link">Writing a memory</a></li><li class="nav-list-item"><a href="/documentation/developer/device/" class="nav-list-link">Writing a device</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Developer documentation for emuStudio" aria-label="Search Developer documentation for emuStudio" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="/" class="site-button" > Back to website </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <script type="text/javascript"> gtag('event', 'developerdoc', { 'event_category': 'developer_compiler', 'event_label': 'Writing a compiler' }); </script> <h1 id="writing-a-compiler"> <a href="#writing-a-compiler" class="anchor-heading" aria-labelledby="writing-a-compiler"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Writing a compiler </h1> <p>A compiler plugin must either implement <a href="/documentation/developer/emulib_javadoc/net/emustudio/emulib/plugins/compiler/Compiler.html" target="_blank">Compiler</a> interface, or extend more bloat-free <a href="/documentation/developer/emulib_javadoc/net/emustudio/emulib/plugins/compiler/AbstractCompiler.html" target="_blank">AbstractCompiler</a> class. Common practice is to utilize <a href="https://www.jflex.de/" target="_blank">JFLex</a> and <a href="http://www2.cs.tum.edu/projects/cup/" target="_blank">Java Cup</a> parser generators, which has direct runtime support in emuStudio.</p> <p>Sample implementation of a compiler might look as follows (just some methods are implemented):</p> <div class="language-java code-example highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CompilerImpl</span> <span class="kd">extends</span> <span class="nc">AbstractCompiler</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">SourceFileExtension</span><span class="o">&gt;</span> <span class="no">SOURCE_FILE_EXTENSIONS</span> <span class="o">=</span> <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
        <span class="k">new</span> <span class="nf">SourceFileExtension</span><span class="o">(</span><span class="s">"asm"</span><span class="o">,</span> <span class="s">"Assembler source file"</span><span class="o">),</span>
    <span class="o">);</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">LexerImpl</span> <span class="n">lexer</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ParserImpl</span> <span class="n">parser</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">MemoryContext</span><span class="o">&lt;</span><span class="nc">Short</span><span class="o">&gt;</span> <span class="n">memory</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">programLocation</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CompilerImpl</span><span class="o">(</span><span class="kt">long</span> <span class="n">pluginID</span><span class="o">,</span> <span class="nc">ApplicationApi</span> <span class="n">applicationApi</span><span class="o">,</span> <span class="nc">PluginSettings</span> <span class="n">pluginSettings</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">pluginID</span><span class="o">,</span> <span class="n">applicationApi</span><span class="o">,</span> <span class="n">pluginSettings</span><span class="o">);</span>
        <span class="n">lexer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LexerImpl</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ParserImpl</span><span class="o">(</span><span class="n">lexer</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">ContextPool</span> <span class="n">pool</span> <span class="o">=</span> <span class="n">applicationApi</span><span class="o">.</span><span class="na">getContextPool</span><span class="o">();</span>
            <span class="n">memory</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="na">getMemoryContext</span><span class="o">(</span><span class="n">pluginID</span><span class="o">,</span> <span class="nc">MemoryContext</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">memory</span><span class="o">.</span><span class="na">getDataType</span><span class="o">()</span> <span class="o">!=</span> <span class="nc">Short</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidContextException</span><span class="o">(</span>
                    <span class="s">"Unexpected memory cell type. Expected Short but was: "</span> <span class="o">+</span> <span class="n">memory</span><span class="o">.</span><span class="na">getDataType</span><span class="o">()</span>
                <span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ContextNotFoundException</span> <span class="o">|</span> <span class="nc">InvalidContextException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Memory context is not available"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">LexicalAnalyzer</span> <span class="nf">getLexer</span><span class="o">(</span><span class="nc">Reader</span> <span class="n">in</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">LexerImpl</span><span class="o">(</span><span class="n">in</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">compile</span><span class="o">(</span><span class="nc">String</span> <span class="n">inputFileName</span><span class="o">,</span> <span class="nc">String</span> <span class="n">outputFileName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">notifyCompileStart</span><span class="o">();</span>
            <span class="nc">IntelHEX</span> <span class="n">hex</span> <span class="o">=</span> <span class="n">compileToHex</span><span class="o">(</span><span class="n">inputFileName</span><span class="o">);</span>

            <span class="n">hex</span><span class="o">.</span><span class="na">generate</span><span class="o">(</span><span class="n">outputFileName</span><span class="o">);</span>
            <span class="n">programLocation</span> <span class="o">=</span> <span class="n">hex</span><span class="o">.</span><span class="na">getProgramLocation</span><span class="o">();</span>
            <span class="n">notifyInfo</span><span class="o">(</span><span class="s">"Compilation was successful.\n Output file: "</span> <span class="o">+</span> <span class="n">outputFileName</span><span class="o">);</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">memory</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">hex</span><span class="o">.</span><span class="na">loadIntoMemory</span><span class="o">(</span><span class="n">memory</span><span class="o">);</span>
                <span class="n">notifyInfo</span><span class="o">(</span><span class="s">"Compiled file was loaded into memory."</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">notifyWarning</span><span class="o">(</span><span class="s">"Memory is not available."</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">notifyError</span><span class="o">(</span><span class="s">"Compilation error: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">notifyCompileFinish</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getProgramLocation</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">programLocation</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">SourceFileExtension</span><span class="o">&gt;</span> <span class="nf">getSourceFileExtensions</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="no">SOURCE_FILE_EXTENSIONS</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">IntelHEX</span> <span class="nf">compileToHex</span><span class="o">(</span><span class="nc">String</span> <span class="n">inputFileName</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
       <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>The compiler does not register any context, but when initialized it obtains optional memory context. If the memory is available, it means that after compilation the program will be loaded in there, otherwise not.</p> <p>Lexer and parser are not shown here, but they are created using mentioned <a href="https://www.jflex.de/" target="_blank">JFlex</a> and <a href="http://www2.cs.tum.edu/projects/cup/" target="_blank">Java cup</a> tools.</p> <p>The compiler utilizes a helper class <a href="/documentation/developer/emulib_javadoc/net/emustudio/emulib/runtime/helpers/IntelHEX.html" target="_blank">IntelHEX</a> from emuLib, which generates Intel HEX files.</p> <p>For more information, see the code of some existing compilers.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
