<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Utility classes - Developer documentation for emuStudio</title> <link rel="shortcut icon" href="/documentation/developer/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/documentation/developer/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3492956-5"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-3492956-5', { 'anonymize_ip': true }); </script> <script src="/documentation/developer/assets/js/vendor/lunr.min.js"></script> <script src="/documentation/developer/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Utility classes | Developer documentation for emuStudio</title> <meta name="generator" content="Jekyll v4.3.1" /> <meta property="og:title" content="Utility classes" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Developer documentation for emuStudio. emuStudio is universal emulation platform and framework targeting mainly academic sphere." /> <meta property="og:description" content="Developer documentation for emuStudio. emuStudio is universal emulation platform and framework targeting mainly academic sphere." /> <link rel="canonical" href="/documentation/developer/plugin_basics/utility_classes" /> <meta property="og:url" content="/documentation/developer/plugin_basics/utility_classes" /> <meta property="og:site_name" content="Developer documentation for emuStudio" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Utility classes" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Developer documentation for emuStudio. emuStudio is universal emulation platform and framework targeting mainly academic sphere.","headline":"Utility classes","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/documentation/developer/assets/logo-1.svg"}},"url":"/documentation/developer/plugin_basics/utility_classes"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/documentation/developer/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Introduction category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/developer/introduction/" class="nav-list-link">Introduction</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Getting started category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/developer/getting_started/" class="nav-list-link">Getting started</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/developer/getting_started/contributing" class="nav-list-link">How to contribute</a></li><li class="nav-list-item "><a href="/documentation/developer/getting_started/gitflow" class="nav-list-link">Git workflow</a></li><li class="nav-list-item "><a href="/documentation/developer/getting_started/documenting" class="nav-list-link">Documenting</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in Plugin basics category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/developer/plugin_basics/" class="nav-list-link">Plugin basics</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/developer/plugin_basics/loading" class="nav-list-link">Loading and initialization</a></li><li class="nav-list-item "><a href="/documentation/developer/plugin_basics/context" class="nav-list-link">Plugin contexts</a></li><li class="nav-list-item active"><a href="/documentation/developer/plugin_basics/utility_classes" class="nav-list-link active">Utility classes</a></li></ul></li><li class="nav-list-item"><a href="/documentation/developer/compiler/" class="nav-list-link">Writing a compiler</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Writing a CPU category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/documentation/developer/cpu/" class="nav-list-link">Writing a CPU</a><ul class="nav-list "><li class="nav-list-item "><a href="/documentation/developer/cpu/rootclass" class="nav-list-link">Plugin Root</a></li><li class="nav-list-item "><a href="/documentation/developer/cpu/runstate" class="nav-list-link">Run states</a></li><li class="nav-list-item "><a href="/documentation/developer/cpu/engine" class="nav-list-link">Emulator engine</a></li><li class="nav-list-item "><a href="/documentation/developer/cpu/disassembler" class="nav-list-link">Disassembler</a></li></ul></li><li class="nav-list-item"><a href="/documentation/developer/memory/" class="nav-list-link">Writing a memory</a></li><li class="nav-list-item"><a href="/documentation/developer/device/" class="nav-list-link">Writing a device</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Developer documentation for emuStudio" aria-label="Search Developer documentation for emuStudio" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="/" class="site-button" > Back to website </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/documentation/developer/plugin_basics/">Plugin basics</a></li> <li class="breadcrumb-nav-list-item"><span>Utility classes</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <script type="text/javascript"> gtag('event', 'developerdoc', { 'event_category': 'developer', 'event_label': 'Utility classes' }); </script> <h1 id="utility-classes"> <a href="#utility-classes" class="anchor-heading" aria-labelledby="utility-classes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Utility classes </h1> <p>emuLib offers a lot of utility classes which can be helpful to emuStudio plugin developers. This page brings some overview of some of them. Please refer to <a href="/documentation/developer/emulib_javadoc/" target="_blank">emuLib javadoc</a> for more detailed information.</p> <h2 id="intel-hex-file-generator"> <a href="#intel-hex-file-generator" class="anchor-heading" aria-labelledby="intel-hex-file-generator"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Intel HEX file generator </h2> <dl> <dt>Class name</dt> <dd><a href="/documentation/developer/emulib_javadoc/net/emustudio/emulib/runtime/io/IntelHEX.html" target="_blank">net.emustudio.emulib.runtime.io.IntelHEX</a></dd> <dt>Usage</dt> <dd>Generates binary output in ASCII form in famous <a href="https://en.wikipedia.org/wiki/Intel_HEX" target="_blank">Intel HEX format</a>. Usually it is useful when writing compiler plugin.</dd> </dl> <p>Upon code generation, the binary code is “added” to the IntelHEX object instance and then either a file is generated, or the content could be loaded into memory:</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">byte</span><span class="o">[]</span> <span class="n">program</span> <span class="o">=</span> <span class="o">...;</span>  <span class="c1">// program doesn't necessarily be in this form, especially if program is spread non-continuously</span>

<span class="nc">IntelHEX</span> <span class="n">hex</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IntelHEX</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">byte</span> <span class="n">b</span> <span class="o">:</span> <span class="n">program</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">hex</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
<span class="o">}</span> 

<span class="n">hex</span><span class="o">.</span><span class="na">generate</span><span class="o">(</span><span class="s">"output-file.bin"</span><span class="o">);</span>

<span class="c1">// alternative:</span>
<span class="c1">// hex.generate(writer);</span>
        
<span class="c1">// Loads content into memory</span>
<span class="c1">// the function `b-&gt;b` is a conversion of bytes to the memory cell type. Here it is assumed memory has Byte cells</span>
<span class="n">hex</span><span class="o">.</span><span class="na">loadIntoMemory</span><span class="o">(</span><span class="n">memory</span><span class="o">,</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="n">b</span><span class="o">);</span>
</code></pre></div></div> <h2 id="bits-utilities"> <a href="#bits-utilities" class="anchor-heading" aria-labelledby="bits-utilities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Bits utilities </h2> <dl> <dt>Class name</dt> <dd><a href="/documentation/developer/emulib_javadoc/net/emustudio/emulib/runtime/helpers/Bits.html" target="_blank">net.emustudio.emulib.runtime.helpers.Bits</a></dd> <dt>Usage</dt> <dd>Wraps <code class="language-plaintext highlighter-rouge">int</code> number and allows various bit-like operations on it (<code class="language-plaintext highlighter-rouge">int</code> has 4 bytes)</dd> </dl> <p>Few useful operations:</p> <ul> <li><code class="language-plaintext highlighter-rouge">Bits absolute()</code>: Make the absolute value from the number stored in two’s complement.</li> <li><code class="language-plaintext highlighter-rouge">Bits reverseBits()</code>: Reverses bits in each byte (max 4 bytes).</li> <li><code class="language-plaintext highlighter-rouge">Bits reverseBytes()</code>: Reverses the bytes.</li> <li><code class="language-plaintext highlighter-rouge">Bits shiftLeft()</code>: Shift the value to the left.</li> <li><code class="language-plaintext highlighter-rouge">Bits shiftRight()</code>: Shift the value to the right.</li> <li><code class="language-plaintext highlighter-rouge">byte[] toBytes()</code>: Converts wrapped <code class="language-plaintext highlighter-rouge">int</code> into array of 4 bytes</li> </ul> <p>This class is heavily used by <a href="https://github.com/emustudio/edigen" target="_blank">edigen</a> dissasembler generator.</p> <h2 id="number-utilities"> <a href="#number-utilities" class="anchor-heading" aria-labelledby="number-utilities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Number utilities </h2> <dl> <dt>Class name</dt> <dd><a href="/documentation/developer/emulib_javadoc/net/emustudio/emulib/runtime/helpers/NumberUtils.html" target="_blank">net.emustudio.emulib.runtime.helpers</a></dd> <dt>Usage</dt> <dd>Lot of useful conversions between various number types.</dd> </dl> <p>Few useful operations:</p> <ul> <li><code class="language-plaintext highlighter-rouge">static int bcd2bin(int bcd)</code>: Converts packed BCD code (1 byte, 2 BCD digits) to binary It is assumed the BCD has little endian.</li> <li><code class="language-plaintext highlighter-rouge">static int bin2bcd(int bin)</code>: Converts a binary number into packed BCD (1 byte, 2 BCD digits)</li> <li><code class="language-plaintext highlighter-rouge">static int[] listToNativeInts(java.util.List&lt;java.lang.Integer&gt; list)</code>: Converts list of Integers into array of native ints.</li> <li><code class="language-plaintext highlighter-rouge">static java.lang.Byte[] nativeBytesToBytes(byte[] array)</code>: Converts native <code class="language-plaintext highlighter-rouge">byte[]</code> array to boxed <code class="language-plaintext highlighter-rouge">Byte[]</code> array.</li> <li><code class="language-plaintext highlighter-rouge">static java.lang.Integer[] nativeBytesToIntegers(byte[] array)</code>: Converts native <code class="language-plaintext highlighter-rouge">byte[]</code> array to boxed <code class="language-plaintext highlighter-rouge">Integer[]</code> array.</li> <li>…</li> <li><code class="language-plaintext highlighter-rouge">static int readBits(byte[] bytes, int start, int length, int bytesStrategy)</code>: Reads an arbitrary number of bits from bytes.</li> <li><code class="language-plaintext highlighter-rouge">static int readInt(byte[] word, int strategy)</code>: Reads an integer from the array of numbers.</li> <li>…</li> <li><code class="language-plaintext highlighter-rouge">static int reverseBits(int value, int numberOfBits)</code>: Reverse bits in integer (max 32-bit) value.</li> <li>…</li> <li><code class="language-plaintext highlighter-rouge">static void writeInt(int value, byte[] output, int strategy)</code>: Split the value into 4 bytes.</li> <li>…</li> </ul> <h2 id="radix-utilities"> <a href="#radix-utilities" class="anchor-heading" aria-labelledby="radix-utilities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Radix utilities </h2> <dl> <dt>Class name</dt> <dd><a href="/documentation/developer/emulib_javadoc/net/emustudio/emulib/runtime/helpers/RadixUtils.html" target="_blank">net.emustudio.emulib.runtime.helpers.RadixUtils</a></dd> <dt>Usage</dt> <dd>Utility functions for various radix conversions.</dd> </dl> <p>At first, an instance of <code class="language-plaintext highlighter-rouge">RadixUtils</code> must be created, because of some pattern regex pre-compilation and possibility to add new radixes dynamically. Usually, a singleton instance is used throughout the application (it’s not thread-safe!).</p> <p>Few useful operations:</p> <ul> <li><code class="language-plaintext highlighter-rouge">void addNumberPattern(RadixUtils.NumberPattern pattern)</code>: Add <code class="language-plaintext highlighter-rouge">NumberPattern</code> for new radix recognition</li> <li><code class="language-plaintext highlighter-rouge">static byte[] convertToNumber(java.lang.String number, int fromRadix)</code>: Convert an integer number in any radix (stored in String) to binary components (bytes) in little endian.</li> <li>…</li> <li><code class="language-plaintext highlighter-rouge">static java.lang.String convertToRadix(byte[] number, int toRadix, boolean littleEndian)</code>: Converts number in any length to a number with specified radix.</li> <li>…</li> <li><code class="language-plaintext highlighter-rouge">static java.lang.String formatBinaryString(int number, int length)</code>: Get formatted binary string of given number.</li> <li>…</li> <li><code class="language-plaintext highlighter-rouge">static RadixUtils getInstance()</code>: returns a singleton instance</li> <li><code class="language-plaintext highlighter-rouge">int parseRadix(java.lang.String number)</code>: Parses a number in known radix into integer.</li> <li>…</li> </ul> <h2 id="sleep-utilities"> <a href="#sleep-utilities" class="anchor-heading" aria-labelledby="sleep-utilities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sleep utilities </h2> <dl> <dt>Class name</dt> <dd><a href="/documentation/developer/emulib_javadoc/net/emustudio/emulib/runtime/helpers/SleepUtils.html" target="_blank">net.emustudio.emulib.runtime.helpers.SleepUtils</a></dd> <dt>Usage</dt> <dd>Provides a function for accurate sleeping of the active thread in all host platforms (Windows, Linux).</dd> </dl> <p>The function <code class="language-plaintext highlighter-rouge">SleepUtils.preciseSleepNanos</code> is more precise than <code class="language-plaintext highlighter-rouge">LockSupport::sleepNanos</code>.</p> <h2 id="timed-event-processing"> <a href="#timed-event-processing" class="anchor-heading" aria-labelledby="timed-event-processing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Timed event processing </h2> <dl> <dt>Class name</dt> <dd><a href="/documentation/developer/emulib_javadoc/net/emustudio/emulib/plugins/cpu/TimedEventsProcessor.html" target="_blank">net.emustudio.emulib.plugins.cpu.TimedEventsProcessor</a></dd> <dt>Usage</dt> <dd>soft real-time system based on a logical system clock, interpreted as number of passed CPU cycles. Events are scheduled to be run every given cycles.</dd> </dl> <p>This class is asynchronous, and thread safe event queue based on logical time. It means time is not advanced regularly, but it is advanced on external calls of <code class="language-plaintext highlighter-rouge">TimedEventsProcessor.advanceClock()</code> method, and by given number of “CPU cycles”.</p> <p>Events are scheduled to be executed every given “cycles” regularly. When the clock is advanced enough to pass over scheduled time of some events, those events are triggered.</p> <p>This class is part of <code class="language-plaintext highlighter-rouge">plugins.cpu</code> package, because advancing system clock is performed by CPU if the instance is obtained through <code class="language-plaintext highlighter-rouge">CPUContext.getTimedEventsProcessor()</code> method. Thus, it is part of CPU public API. It is still possible to use this class independently too, but then use must make new instance and make sure of advancing the clock for events to be triggered.</p> <p>Timed event processing can be used for accurate emulation of multiple devices which speed or actions depend on the number of executed CPU cycles.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
